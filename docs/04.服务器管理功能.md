# 服务器管理功能

## 功能概述

服务器管理功能允许用户配置和管理本地及远程 Ollama 服务器。用户可以添加、编辑、删除远程服务器配置，并在不同服务器之间切换。

## 功能详情

### 1. 本地服务器配置

- 默认本地服务器地址：http://localhost:11434
- 支持自定义本地服务器地址
- 本地服务器始终可用

### 2. 远程服务器管理

#### 添加远程服务器
- 用户可以添加新的远程服务器配置
- 需要提供服务器名称、基础URL、API密钥等信息
- 添加前会验证服务器可达性

#### 编辑远程服务器
- 用户可以修改现有远程服务器配置
- 支持修改服务器名称、URL、API密钥等信息

#### 删除远程服务器
- 用户可以删除不需要的远程服务器配置
- 删除前会显示确认对话框

#### 设置活动服务器
- 用户可以设置某个远程服务器为活动状态
- 活动服务器在应用启动时自动选中

### 3. 服务器测试

- 用户可以测试服务器连接状态
- 测试会尝试访问服务器的 /api/tags 端点
- 测试结果会显示成功或失败信息

## 界面设计

### 主要组件

1. **服务器配置界面**：
   - 展示本地服务器配置信息
   - 展示远程服务器列表
   - 提供添加、编辑、删除服务器的操作按钮

2. **服务器表单**：
   - 用于添加或编辑服务器配置
   - 包含服务器名称、URL、API密钥等输入字段
   - 提供测试连接按钮

3. **服务器列表**：
   - 表格形式展示所有远程服务器
   - 显示服务器名称、URL、状态等信息
   - 提供编辑、删除、设置为活动等操作按钮

## API 接口

### 后端接口

1. `GetOllamaServerConfig() (string, error)`：
   - 获取本地服务器配置

2. `SaveOllamaServerConfig(baseUrl string) error`：
   - 保存本地服务器配置

3. `GetRemoteServers() ([]OllamaServerConfig, error)`：
   - 获取远程服务器列表

4. `AddRemoteServer(server OllamaServerConfig) error`：
   - 添加远程服务器

5. `UpdateRemoteServer(server OllamaServerConfig) error`：
   - 更新远程服务器

6. `DeleteRemoteServer(serverID string) error`：
   - 删除远程服务器

7. `SetActiveServer(serverID string) error`：
   - 设置活动服务器

8. `TestOllamaServer(baseURL string) error`：
   - 测试服务器连接

## 数据结构

### 服务器配置结构

```go
type OllamaServerConfig struct {
    ID         string // 服务器ID
    Name       string // 服务器名称
    BaseURL    string // 基础URL
    APIKey     string // API密钥
    IsActive   bool   // 是否为活动服务器
    TestStatus string // 测试状态
}
```

## 配置管理

### 本地配置存储

- 本地服务器配置存储在本地存储中
- 键名为 "ollama_config:local"
- 默认值为 "http://localhost:11434"

### 远程配置存储

- 远程服务器配置存储在本地存储中
- 键名为 "ollama_config:remote_servers"
- 以 JSON 格式存储服务器配置数组

### 配置同步

- 应用启动时加载服务器配置
- 配置变更时实时保存到存储
- 支持多设备配置同步（通过 duolasdk）

## 错误处理

### 网络错误处理

- 服务器不可达时显示详细错误信息
- 提供重试机制
- 区分网络错误和认证错误

### 配置错误处理

- 配置格式错误时提供友好的错误提示
- 自动恢复到上一次正确配置
- 防止无效配置导致应用无法启动

## 安全考虑

### API 密钥管理

- API 密钥在存储时应考虑加密处理
- 界面显示时应隐藏密钥具体内容
- 支持密钥的更新和删除

### 服务器验证

- 添加远程服务器时必须验证可达性
- 定期检查服务器状态
- 防止恶意服务器配置