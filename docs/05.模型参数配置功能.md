# 模型参数配置功能

## 功能概述

模型参数配置功能允许用户为不同的模型设置运行参数，以控制模型的行为和输出特性。这些参数包括温度、top_p、上下文大小等，会影响模型的创造性、一致性和资源使用。

## 功能详情

### 1. 参数类型

#### Temperature（温度）
- 控制模型输出的随机性
- 值范围：0.0-1.0
- 较低值使输出更确定性和一致
- 较高值使输出更多样化和创造性

#### Top P（ nucleus sampling ）
- 控制模型考虑的词汇范围
- 值范围：0.0-1.0
- 较低值限制模型只考虑高概率词汇
- 较高值允许模型考虑更多词汇

#### Context（上下文大小）
- 控制模型处理的上下文长度
- 值范围：1-32768
- 较大值允许更长的上下文理解
- 较大值需要更多内存资源

#### Top K
- 限制模型在每一步只考虑前K个词汇
- 值范围：正整数
- 较小值使输出更集中
- 较大值使输出更多样化

#### Num Predict
- 控制模型生成的最大token数
- 值范围：正整数
- 影响生成文本的长度

#### Repeat Penalty
- 控制模型重复生成相同内容的惩罚系数
- 值范围：正数
- 较高值减少重复内容
- 较低值允许更多重复

### 2. 参数管理

#### 默认参数
- 每个模型都有默认参数配置
- 默认参数在模型未运行时使用
- 默认值：
  - Temperature: 0.8
  - Top P: 0.9
  - Top K: 40
  - Context: 2048
  - Num Predict: 512
  - Repeat Penalty: 1.1

#### 运行时参数
- 模型运行时使用的参数
- 可以在运行时修改并保存
- 与默认参数独立存储

#### 参数保存
- 支持保存模型参数配置
- 参数配置与模型名称关联
- 支持为同一模型保存多套参数配置

### 3. 参数应用

#### 启动模型时应用
- 运行模型时使用配置的参数
- 参数通过 API 传递给 Ollama 服务

#### 运行时调整
- 支持在模型运行时调整参数
- 调整后的参数影响后续请求

## 界面设计

### 主要组件

1. **参数配置表单**：
   - 滑块控件用于调整 Temperature 和 Top P
   - 数字输入框用于调整 Context 等整数参数
   - 提供参数重置功能

2. **参数操作按钮**：
   - 保存参数按钮
   - 重置参数按钮
   - 应用参数按钮（如果支持运行时调整）

## API 接口

### 后端接口

1. `GetModelParams(modelName string) (map[string]interface{}, error)`：
   - 获取指定模型的参数配置

2. `SetModelParams(modelName string, params map[string]interface{}) error`：
   - 设置指定模型的参数配置

3. `SaveModelSettings(modelName string, options map[string]interface{}) error`：
   - 保存模型设置到存储

4. `GetModelSettings(modelName string) (map[string]interface{}, error)`：
   - 获取模型设置

## 数据结构

### 模型参数结构

```go
type ModelParams struct {
    Temperature   float64 // 温度
    TopP          float64 // Top P
    TopK          int     // Top K
    Context       int     // 上下文大小
    NumPredict    int     // 预测数量
    RepeatPenalty float64 // 重复惩罚
}
```

## 参数验证

### 输入验证

- 所有参数值必须在有效范围内
- 提供友好的错误提示信息
- 防止无效值导致模型运行错误

### 默认值处理

- 参数缺失时使用默认值
- 默认值存储在代码中
- 支持通过配置文件自定义默认值

## 存储管理

### 参数存储

- 模型参数存储在本地存储中
- 键名格式："model_options_{modelName}"
- 以 JSON 格式存储参数配置

### 存储同步

- 参数变更时实时保存到存储
- 支持多设备参数同步（通过 duolasdk）
- 应用启动时加载已保存的参数

## 用户体验优化

### 界面交互

- 使用直观的控件类型（滑块、数字输入框等）
- 提供参数说明和推荐值
- 支持参数配置的导入导出

### 实时反馈

- 参数调整时提供实时预览
- 参数保存成功后显示确认消息
- 参数应用时显示加载状态

## 错误处理

### 参数错误

- 参数值超出范围时显示警告
- 参数类型错误时提供友好的错误提示
- 参数保存失败时保持界面状态

### 模型错误

- 参数导致模型运行失败时记录日志
- 提供参数调整建议
- 支持恢复到上一次正确配置