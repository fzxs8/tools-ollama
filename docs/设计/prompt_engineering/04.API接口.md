# PromptPilot API接口

**架构说明**: 本文档描述的“API接口”指的是前端Vue组件通过Wails框架直接调用的后端Go函数。这些函数定义在 `prompt_pilot.go` 中。

## 1. Prompt 生成与优化

### 1.1 `GeneratePromptStream(idea string, model string, serverId string) error`

- **功能描述**: **触发** 一个后端的异步任务来为单个模型流式生成Prompt。
- **重要说明**: 此函数 **不直接返回数据流**。它会立即返回一个`error`（如果触发失败，如参数错误）或`nil`（如果触发成功）。真正的数据和状态是通过后端的全局事件发送给前端的。
- **关联事件**:
  - `prompt_pilot_stream`: 接收生成的数据块。
  - `prompt_pilot_stream_error`: 接收生成过程中的错误。
  - `prompt_pilot_stream_done`: 接收生成完成的信号。
  - (详细的数据结构请参考 `03.数据结构.md`)

### 1.2 `OptimizePrompt(content string, feedback string, model string, serverId string) (string, error)`

- **功能描述**: 根据用户反馈优化Prompt（当前为占位符实现）。

## 2. Prompt 管理 (CRUD)

### 2.1 `SavePrompt(prompt Prompt) error`

- **功能描述**: 创建或更新一个Prompt。
- **实现逻辑**: 
  - **创建**: 如果传入的 `prompt` 对象的 `ID` 字段为空字符串，函数会为其生成一个新的UUID，设置`CreatedAt`、`UpdatedAt`时间戳和版本号`1`，然后存入数据库。
  - **更新**: 如果 `prompt` 对象已存在 `ID`，函数会更新其 `UpdatedAt` 时间戳，并将 `Version` 加一。

### 2.2 `ListPrompts() ([]Prompt, error)`

- **功能描述**: 获取所有已保存的Prompt列表。

### 2.3 `GetPrompt(id string) (Prompt, error)`

- **功能描述**: 根据ID获取单个Prompt的详细信息。

### 2.4 `DeletePrompt(id string) error`

- **功能描述**: 根据ID删除一个Prompt。

## 3. 依赖的公共接口

**调用说明**: `PromptPilot` 模块本身不处理服务和模型的配置，而是调用由 **`main/App.go`** 提供的应用级公共函数，以确保配置在整个应用中的统一性。前端在 `PromptPilot.vue` 中调用的相关函数实际上是这些公共函数。

- `GetOllamaServerConfig()`
- `GetRemoteServers()`
- `GetActiveServer()`
- `ListModelsByServer(serverId string)`
