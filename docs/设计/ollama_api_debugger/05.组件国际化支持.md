# API 调试器组件国际化支持

## 概述

本文档记录了为 `ApiDebugger.vue` 和 `ApiDebuggerWidget.vue` 组件添加国际化支持的实现过程，确保组件在语言切换时能够正确显示对应的翻译文本。

## 问题描述

在之前的实现中，两个 API 调试器组件中的文本都是硬编码的中文字符串，导致：

1. **语言切换无效**: 切换语言时，组件内的文本不会改变
2. **用户体验不一致**: 其他组件支持多语言，但调试器组件不支持
3. **国际化不完整**: 影响应用的整体国际化体验

## 解决方案

### 1. 组件国际化改造

#### 1.1 ApiDebugger.vue 组件

**导入国际化支持**:
```typescript
import { useI18n } from 'vue-i18n';

const { t } = useI18n();
```

**主要改动**:
- 按钮文本: `发送` → `{{ t('apiDebugger.send') }}`
- 标签页标题: `查询参数` → `{{ t('apiDebugger.queryParams') }}`
- 占位符文本: `键` → `:placeholder="t('apiDebugger.key')"`
- 状态信息: `发送请求中...` → `{{ t('apiDebugger.loading') }}`
- 错误信息: `请求失败` → `t('apiDebugger.requestFailed')`

**动态占位符处理**:
```typescript
const computedUrlPlaceholder = computed(() => 
  props.urlPlaceholder || t('apiDebugger.enterUrl')
);
```

#### 1.2 ApiDebuggerWidget.vue 组件

**导入国际化支持**:
```typescript
import { useI18n } from 'vue-i18n';

const { t } = useI18n();
```

**主要改动**:
- 按钮文本: `测试` → `{{ t('common.test') }}`
- 标题文本: `请求体` → `{{ t('apiDebugger.body') }}`
- 错误提示: `请先配置目标 Ollama 服务器` → `t('apiDebugger.configureServerFirst')`

### 2. 国际化键值定义

#### 2.1 中文翻译 (zh.json)

```json
{
  "apiDebugger": {
    "queryParams": "查询参数",
    "headers": "请求头",
    "body": "请求体",
    "key": "键",
    "value": "值",
    "remove": "移除",
    "addParameter": "添加参数",
    "addHeader": "添加请求头",
    "none": "无",
    "raw": "原始",
    "formData": "表单数据",
    "enterRawContent": "输入原始请求体内容...",
    "addFormItem": "添加表单项",
    "sending": "发送中...",
    "send": "发送",
    "loading": "加载中...",
    "error": "错误",
    "status": "状态",
    "duration": "耗时",
    "responseBody": "响应体",
    "responseHeaders": "响应头",
    "clickSendToRequest": "点击\"发送\"按钮发起请求",
    "enterUrl": "输入请求 URL",
    "requestFailed": "请求失败",
    "configureServerFirst": "请先配置目标 Ollama 服务器"
  },
  "common": {
    "test": "测试"
  }
}
```

#### 2.2 英文翻译 (en.json)

```json
{
  "apiDebugger": {
    "queryParams": "Query Params",
    "headers": "Headers",
    "body": "Body",
    "key": "Key",
    "value": "Value",
    "remove": "Remove",
    "addParameter": "Add Parameter",
    "addHeader": "Add Header",
    "none": "None",
    "raw": "Raw",
    "formData": "Form Data",
    "enterRawContent": "Enter raw request body content...",
    "addFormItem": "Add Form Item",
    "sending": "Sending...",
    "send": "Send",
    "loading": "Loading...",
    "error": "Error",
    "status": "Status",
    "duration": "Duration",
    "responseBody": "Response Body",
    "responseHeaders": "Response Headers",
    "clickSendToRequest": "Click \"Send\" button to make a request",
    "enterUrl": "Enter request URL",
    "requestFailed": "Request failed",
    "configureServerFirst": "Please configure target Ollama server first"
  },
  "common": {
    "test": "Test"
  }
}
```

## 实现细节

### 1. 模板中的国际化

**标签页按钮**:
```vue
<!-- 改造前 -->
<button>查询参数</button>

<!-- 改造后 -->
<button>{{ t('apiDebugger.queryParams') }}</button>
```

**输入框占位符**:
```vue
<!-- 改造前 -->
<input placeholder="键" />

<!-- 改造后 -->
<input :placeholder="t('apiDebugger.key')" />
```

**条件渲染文本**:
```vue
<!-- 改造前 -->
{{ isLoading ? '发送中...' : '发送' }}

<!-- 改造后 -->
{{ isLoading ? t('apiDebugger.sending') : t('apiDebugger.send') }}
```

### 2. 脚本中的国际化

**错误信息**:
```typescript
// 改造前
error.value = '请输入请求 URL';

// 改造后
error.value = t('apiDebugger.enterUrl');
```

**字符串拼接**:
```typescript
// 改造前
error.value = `请求失败: ${e}`;

// 改造后
error.value = `${t('apiDebugger.requestFailed')}: ${e}`;
```

### 3. Props 处理

**动态默认值**:
```typescript
// 改造前
const props = withDefaults(defineProps<Props>(), {
  urlPlaceholder: '输入请求 URL'
});

// 改造后
const props = withDefaults(defineProps<Props>(), {
  urlPlaceholder: ''
});

const computedUrlPlaceholder = computed(() => 
  props.urlPlaceholder || t('apiDebugger.enterUrl')
);
```

## 测试验证

### 1. 功能测试

- ✅ 组件正常渲染
- ✅ 所有文本显示正确
- ✅ 交互功能正常工作
- ✅ 错误处理正确显示

### 2. 国际化测试

- ✅ 中文环境下显示中文文本
- ✅ 英文环境下显示英文文本
- ✅ 语言切换时文本实时更新
- ✅ 占位符文本正确国际化

### 3. 兼容性测试

- ✅ 与现有组件集成正常
- ✅ 不影响其他功能
- ✅ 样式保持一致
- ✅ 响应式布局正常

## 最佳实践

### 1. 国际化键命名规范

- **层级结构**: 使用 `apiDebugger.xxx` 的命名空间
- **语义化**: 键名能够清晰表达含义
- **一致性**: 相同功能使用相同的键名

### 2. 文本处理原则

- **完整替换**: 所有用户可见文本都要国际化
- **动态处理**: 使用计算属性处理复杂的文本逻辑
- **错误信息**: 包括错误提示在内的所有信息

### 3. 组件设计考虑

- **Props 兼容**: 保持 Props 接口的向后兼容性
- **默认值**: 提供合理的国际化默认值
- **类型安全**: 确保 TypeScript 类型定义正确

## 影响范围

### 1. 直接影响

- `ApiDebugger.vue` 组件完全国际化
- `ApiDebuggerWidget.vue` 组件完全国际化
- 国际化文件新增相关翻译键

### 2. 间接影响

- 提升整体应用的国际化完整性
- 改善多语言用户的使用体验
- 为后续组件国际化提供参考模式

## 总结

通过这次国际化改造：

1. **解决了问题**: 两个 API 调试器组件现在完全支持多语言切换
2. **提升了体验**: 用户可以在熟悉的语言环境中使用调试功能
3. **保持了兼容**: 改造过程中保持了组件的向后兼容性
4. **建立了规范**: 为其他组件的国际化提供了标准模式

这次改造确保了 API 调试器组件与整个应用的国际化体验保持一致，为用户提供了更好的多语言支持。