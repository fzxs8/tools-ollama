# Ollama API 调试器模块 - 数据结构 (V2)

## 1. 前端请求数据结构 (用于 UI 绑定和传递给后端)

```typescript
// types.ts (Conceptual)

interface KeyValue {
  key: string;
  value: string;
}

interface KeyValueEnablable extends KeyValue {
  enabled: boolean;
}

enum RequestBodyType {
  None = 'none',
  Raw = 'raw',
  FormData = 'formData',
}

enum RawBodyContentType {
  Json = 'application/json',
  Text = 'text/plain',
  Html = 'text/html',
  Xml = 'application/xml',
}

interface RequestBody {
  type: RequestBodyType;
  rawContent?: string;
  rawContentType?: RawBodyContentType;
  formData?: KeyValue[];
}

interface ApiRequest {
  method: 'GET' | 'POST' | 'PUT' | 'DELETE' | 'HEAD' | 'PATCH' | 'OPTIONS';
  selectedServerId: string;
  path: string;
  queryParams: KeyValueEnablable[];
  headers: KeyValueEnablable[];
  body: RequestBody;
}
```

## 2. 后端请求处理 (Go)

为确保对请求参数（特别是请求头）的完全控制，后端实现已**放弃**使用 `duolasdk/core/net.go` 中的 `HttpCli` 封装。

**当前实现**: `ollama_api_debugger.go` 中的 `SendHttpRequest` 函数直接使用 Go 标准库 `net/http` 来完成请求的构建和发送。

*   **URL构建**: 使用 `url.JoinPath` 和 `url.Parse` 拼接 BaseURL, Path 和查询参数。
*   **请求体构建**: 使用 `strings.NewReader` 将前端传来的 `rawContent` 或编码后的 `formData` 转换为 `io.Reader`。
*   **请求头构建**: 手动创建一个 `http.Header` 对象，并逐一设置从前端传来的所有启用的请求头，包括根据请求体类型动态设置的 `Content-Type`。
*   **请求发送**: 使用 `http.NewRequestWithContext` 创建一个 `*http.Request` 对象，并由标准的 `http.Client` 的 `Do` 方法发送。

这种方式绕过了所有中间封装，保证了前端所见即后端所发。

## 3. 后端响应处理 (Go)

响应同样由 `net/http` 的 `*http.Response` 对象处理。

*   从 `resp.StatusCode` 和 `resp.Header` 中读取状态码和响应头。
*   使用 `io.ReadAll` 从 `resp.Body` 中读取响应体字符串。
*   将这些信息组装成 `types.ApiResponse` 结构体返回给前端。

## 4. 前后端交互数据结构 (Go & TypeScript)

这些结构定义在 `tools-ollama/types/types.go` 中，并由 Wails 自动生成对应的 TypeScript 版本。

```go
// tools-ollama/types/types.go

// (只展示相关部分)

type FormDataItem struct {
	Key   string `json:"key"`
	Value string `json:"value"`
}

type RequestBody struct {
	Type           RequestBodyType      `json:"type"`
	RawContent     string               `json:"rawContent,omitempty"`
	RawContentType RawBodyContentType   `json:"rawContentType,omitempty"`
	FormData       []FormDataItem       `json:"formData,omitempty"` // 已修正为正确的 struct slice
}

type ApiRequest struct {
	Method           string          `json:"method"`
	SelectedServerID string          `json:"selectedServerId"`
	Path             string          `json:"path"`
	QueryParams      []QueryParam    `json:"queryParams"`
	Headers          []RequestHeader `json:"headers"`
	Body             RequestBody     `json:"body"`
}

type ApiResponse struct {
	StatusCode        int             `json:"statusCode"`
	StatusText        string          `json:"statusText"`
	Headers           []RequestHeader `json:"headers"`
	Body              string          `json:"body"`
	RequestDurationMs int64           `json:"requestDurationMs"`
	Error             string          `json:"error,omitempty"`
}
```
