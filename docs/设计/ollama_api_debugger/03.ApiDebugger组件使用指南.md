# ApiDebugger ç»„ä»¶ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

`ApiDebugger` æ˜¯ä¸€ä¸ªé€šç”¨çš„ API è°ƒè¯•ç»„ä»¶ï¼Œç±»ä¼¼äº Postman çš„åŠŸèƒ½ï¼Œå¯ä»¥åœ¨ä»»ä½• Vue é¡¹ç›®ä¸­å¤ç”¨ã€‚å®ƒæä¾›äº†å®Œæ•´çš„ HTTP è¯·æ±‚æ„å»ºå’Œå“åº”æŸ¥çœ‹åŠŸèƒ½ã€‚

## ç»„ä»¶ç‰¹æ€§

- ğŸš€ **ç±» Postman ç•Œé¢**: ç†Ÿæ‚‰çš„ç”¨æˆ·ä½“éªŒï¼Œé™ä½å­¦ä¹ æˆæœ¬
- ğŸ”§ **å®Œæ•´çš„è¯·æ±‚æ„å»º**: æ”¯æŒæŸ¥è¯¢å‚æ•°ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“é…ç½®
- ğŸ“Š **å“åº”å±•ç¤º**: è‡ªåŠ¨æ ¼å¼åŒ– JSONï¼Œæ˜¾ç¤ºçŠ¶æ€ç å’Œè€—æ—¶
- ğŸ¯ **é«˜åº¦å¯å®šåˆ¶**: æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨å’ŒåŸºç¡€ URL
- ğŸ’¡ **TypeScript æ”¯æŒ**: å®Œæ•´çš„ç±»å‹å®šä¹‰

## åŸºæœ¬ç”¨æ³•

### 1. å¯¼å…¥ç»„ä»¶

```vue
<script setup lang="ts">
import ApiDebugger from '@/components/ApiDebugger.vue';
</script>
```

### 2. ç®€å•ä½¿ç”¨

```vue
<template>
  <div class="container">
    <ApiDebugger 
      url-placeholder="è¾“å…¥ API åœ°å€"
    />
  </div>
</template>
```

### 3. å¸¦åŸºç¡€ URL

```vue
<template>
  <div class="container">
    <ApiDebugger 
      base-url="https://api.example.com"
      url-placeholder="/api/users"
    />
  </div>
</template>
```

## é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨

```vue
<template>
  <div class="container">
    <ApiDebugger 
      :base-url="baseUrl"
      :on-request="handleCustomRequest"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import ApiDebugger from '@/components/ApiDebugger.vue';

const baseUrl = ref('https://api.example.com');

// è‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨
const handleCustomRequest = async (request) => {
  // æ·»åŠ è®¤è¯å¤´
  const headers = {
    'Authorization': 'Bearer your-token',
    ...request.headers.reduce((acc, h) => {
      if (h.enabled && h.key) {
        acc[h.key] = h.value;
      }
      return acc;
    }, {})
  };

  // æ„å»ºå®Œæ•´ URL
  let url = request.url;
  if (baseUrl.value && !url.startsWith('http')) {
    url = baseUrl.value.replace(/\/$/, '') + '/' + url.replace(/^\//, '');
  }

  // æ·»åŠ æŸ¥è¯¢å‚æ•°
  const enabledParams = request.queryParams.filter(p => p.enabled && p.key);
  if (enabledParams.length > 0) {
    const params = new URLSearchParams();
    enabledParams.forEach(p => params.append(p.key, p.value));
    url += (url.includes('?') ? '&' : '?') + params.toString();
  }

  // æ„å»ºè¯·æ±‚ä½“
  let body;
  if (request.body.type === 'raw' && request.body.rawContent) {
    body = request.body.rawContent;
    if (request.body.rawContentType && !headers['Content-Type']) {
      headers['Content-Type'] = request.body.rawContentType;
    }
  } else if (request.body.type === 'formData') {
    const formData = new FormData();
    request.body.formData.filter(f => f.key).forEach(f => {
      formData.append(f.key, f.value);
    });
    body = formData;
  }

  // å‘é€è¯·æ±‚
  const startTime = Date.now();
  try {
    const response = await fetch(url, {
      method: request.method,
      headers,
      body: ['GET', 'HEAD'].includes(request.method) ? undefined : body
    });
    const endTime = Date.now();

    const responseHeaders = Array.from(response.headers.entries()).map(([key, value]) => ({
      key,
      value
    }));

    return {
      statusCode: response.status,
      statusText: response.statusText,
      headers: responseHeaders,
      body: await response.text(),
      requestDurationMs: endTime - startTime
    };
  } catch (error) {
    throw new Error(`è¯·æ±‚å¤±è´¥: ${error.message}`);
  }
};
</script>
```

### 2. ä½¿ç”¨ç»„ä»¶å¼•ç”¨

```vue
<template>
  <div class="container">
    <div class="toolbar">
      <button @click="loadApiTemplate">åŠ è½½æ¨¡æ¿</button>
      <button @click="clearAll">æ¸…ç©º</button>
    </div>
    
    <ApiDebugger 
      ref="apiDebuggerRef"
      :base-url="baseUrl"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import ApiDebugger from '@/components/ApiDebugger.vue';

const apiDebuggerRef = ref();
const baseUrl = ref('https://jsonplaceholder.typicode.com');

// åŠ è½½ API æ¨¡æ¿
const loadApiTemplate = () => {
  if (apiDebuggerRef.value) {
    apiDebuggerRef.value.setRequest({
      method: 'POST',
      url: '/posts',
      headers: [
        { key: 'Content-Type', value: 'application/json', enabled: true }
      ],
      body: {
        type: 'raw',
        rawContentType: 'application/json',
        rawContent: JSON.stringify({
          title: 'foo',
          body: 'bar',
          userId: 1
        }, null, 2)
      }
    });
  }
};

// æ¸…ç©ºæ‰€æœ‰å†…å®¹
const clearAll = () => {
  if (apiDebuggerRef.value) {
    apiDebuggerRef.value.setRequest({
      method: 'GET',
      url: '',
      queryParams: [],
      headers: [],
      body: {
        type: 'none',
        rawContent: '',
        rawContentType: 'application/json',
        formData: []
      }
    });
    apiDebuggerRef.value.clearResponse();
  }
};
</script>
```

## Props å±æ€§

| å±æ€§ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `baseUrl` | `string` | `''` | åŸºç¡€ URLï¼Œä¼šè‡ªåŠ¨æ‹¼æ¥åˆ°è¯·æ±‚ URL å‰ |
| `urlPlaceholder` | `string` | `'è¾“å…¥è¯·æ±‚ URL'` | URL è¾“å…¥æ¡†çš„å ä½ç¬¦ |
| `onRequest` | `function` | `undefined` | è‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨å‡½æ•° |

## æš´éœ²çš„æ–¹æ³•

### setRequest(request)

è®¾ç½®è¯·æ±‚å‚æ•°ã€‚

```typescript
interface ApiRequest {
  method: string;
  url: string;
  queryParams: KeyValue[];
  headers: KeyValue[];
  body: RequestBody;
}

interface KeyValue {
  key: string;
  value: string;
  enabled: boolean;
}

interface RequestBody {
  type: 'none' | 'raw' | 'formData';
  rawContent: string;
  rawContentType: string;
  formData: FormDataItem[];
}
```

### sendRequest()

æ‰‹åŠ¨è§¦å‘è¯·æ±‚å‘é€ã€‚

### clearResponse()

æ¸…ç©ºå“åº”ç»“æœã€‚

## æ ·å¼å®šåˆ¶

ç»„ä»¶ä½¿ç”¨äº† scoped æ ·å¼ï¼Œå¦‚æœéœ€è¦è‡ªå®šä¹‰æ ·å¼ï¼Œå¯ä»¥ä½¿ç”¨æ·±åº¦é€‰æ‹©å™¨ï¼š

```vue
<style>
.container :deep(.api-debugger) {
  border-radius: 12px;
}

.container :deep(.send-btn) {
  background-color: #10b981;
}
</style>
```

## å®Œæ•´ç¤ºä¾‹

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ ApiDebugger ç»„ä»¶ï¼š

```vue
<template>
  <div class="api-test-page">
    <div class="header">
      <h1>API æµ‹è¯•å·¥å…·</h1>
      <div class="server-selector">
        <label>æœåŠ¡å™¨:</label>
        <select v-model="selectedServer">
          <option value="">é€‰æ‹©æœåŠ¡å™¨</option>
          <option v-for="server in servers" :key="server.id" :value="server.url">
            {{ server.name }}
          </option>
        </select>
      </div>
    </div>

    <div class="content">
      <div class="sidebar">
        <h3>API æ¨¡æ¿</h3>
        <ul class="api-templates">
          <li 
            v-for="template in apiTemplates" 
            :key="template.name"
            @click="loadTemplate(template)"
            class="template-item"
          >
            <span :class="['method', template.method.toLowerCase()]">
              {{ template.method }}
            </span>
            {{ template.name }}
          </li>
        </ul>
      </div>

      <div class="main">
        <ApiDebugger 
          ref="debuggerRef"
          :base-url="selectedServer"
          :on-request="handleRequest"
        />
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue';
import ApiDebugger from '@/components/ApiDebugger.vue';

const debuggerRef = ref();
const selectedServer = ref('');

const servers = reactive([
  { id: 1, name: 'å¼€å‘ç¯å¢ƒ', url: 'https://dev-api.example.com' },
  { id: 2, name: 'æµ‹è¯•ç¯å¢ƒ', url: 'https://test-api.example.com' },
  { id: 3, name: 'ç”Ÿäº§ç¯å¢ƒ', url: 'https://api.example.com' }
]);

const apiTemplates = reactive([
  {
    name: 'è·å–ç”¨æˆ·åˆ—è¡¨',
    method: 'GET',
    url: '/api/users',
    queryParams: [
      { key: 'page', value: '1', enabled: true },
      { key: 'limit', value: '10', enabled: true }
    ]
  },
  {
    name: 'åˆ›å»ºç”¨æˆ·',
    method: 'POST',
    url: '/api/users',
    headers: [
      { key: 'Content-Type', value: 'application/json', enabled: true }
    ],
    body: {
      type: 'raw',
      rawContentType: 'application/json',
      rawContent: JSON.stringify({
        name: 'John Doe',
        email: 'john@example.com'
      }, null, 2)
    }
  }
]);

const loadTemplate = (template) => {
  if (debuggerRef.value) {
    debuggerRef.value.setRequest({
      method: template.method,
      url: template.url,
      queryParams: template.queryParams || [],
      headers: template.headers || [],
      body: template.body || {
        type: 'none',
        rawContent: '',
        rawContentType: 'application/json',
        formData: []
      }
    });
  }
};

const handleRequest = async (request) => {
  // æ·»åŠ è®¤è¯å¤´
  const authToken = localStorage.getItem('auth_token');
  if (authToken) {
    request.headers.push({
      key: 'Authorization',
      value: `Bearer ${authToken}`,
      enabled: true
    });
  }

  // ä½¿ç”¨é»˜è®¤çš„ fetch å¤„ç†
  // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šè‡ªå®šä¹‰é€»è¾‘
  return null; // è¿”å› null ä½¿ç”¨é»˜è®¤å¤„ç†
};
</script>

<style scoped>
.api-test-page {
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.header {
  padding: 1rem;
  background: #fff;
  border-bottom: 1px solid #e2e8f0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.server-selector select {
  padding: 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  margin-left: 0.5rem;
}

.content {
  flex: 1;
  display: flex;
  overflow: hidden;
}

.sidebar {
  width: 250px;
  background: #fff;
  border-right: 1px solid #e2e8f0;
  padding: 1rem;
  overflow-y: auto;
}

.api-templates {
  list-style: none;
  padding: 0;
  margin: 0;
}

.template-item {
  padding: 0.75rem;
  cursor: pointer;
  border-radius: 6px;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: background-color 0.2s;
}

.template-item:hover {
  background-color: #f1f5f9;
}

.method {
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: bold;
  color: white;
  min-width: 50px;
  text-align: center;
}

.method.get { background-color: #3b82f6; }
.method.post { background-color: #10b981; }
.method.put { background-color: #f59e0b; }
.method.delete { background-color: #ef4444; }

.main {
  flex: 1;
  padding: 1rem;
  overflow: hidden;
}
</style>
```

## æ€»ç»“

`ApiDebugger` ç»„ä»¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„ API è°ƒè¯•è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **æ˜“äºä½¿ç”¨**: ç®€å•çš„ props é…ç½®å³å¯å¼€å§‹ä½¿ç”¨
2. **é«˜åº¦å¯å®šåˆ¶**: æ”¯æŒè‡ªå®šä¹‰è¯·æ±‚å¤„ç†å™¨å’Œæ ·å¼
3. **åŠŸèƒ½å®Œæ•´**: æ¶µç›–äº† API è°ƒè¯•çš„æ‰€æœ‰å¸¸ç”¨åŠŸèƒ½
4. **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript æ”¯æŒ
5. **å“åº”å¼è®¾è®¡**: é€‚é…ä¸åŒå±å¹•å°ºå¯¸

é€šè¿‡è¿™ä¸ªç»„ä»¶ï¼Œä½ å¯ä»¥å¿«é€Ÿåœ¨ä»»ä½• Vue é¡¹ç›®ä¸­é›†æˆ API è°ƒè¯•åŠŸèƒ½ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚