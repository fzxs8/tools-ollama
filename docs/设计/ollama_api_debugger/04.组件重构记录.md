# Ollama API 调试器组件重构记录

## 重构概述

本次重构将原有的 `OllamaApiDebugger.vue` 中的 API 调试功能抽取为一个通用的 `ApiDebugger.vue` 组件，实现了代码复用和功能解耦。

## 重构目标

1. **代码复用**: 创建可在任何项目中使用的通用 API 调试组件
2. **功能解耦**: 将 UI 逻辑与业务逻辑分离
3. **易于维护**: 简化代码结构，提高可维护性
4. **扩展性**: 支持自定义请求处理器和配置

## 重构内容

### 1. 新增文件

#### `/frontend/src/components/ApiDebugger.vue`
- **功能**: 通用的 API 调试组件
- **特性**: 
  - 类 Postman 界面设计
  - 支持 GET/POST/PUT/DELETE/PATCH/HEAD 方法
  - 查询参数、请求头、请求体编辑
  - 响应结果展示和格式化
  - 自定义请求处理器支持
- **Props**:
  - `baseUrl`: 基础 URL
  - `urlPlaceholder`: URL 输入框占位符
  - `onRequest`: 自定义请求处理器
- **暴露方法**:
  - `setRequest()`: 设置请求参数
  - `sendRequest()`: 发送请求
  - `clearResponse()`: 清空响应

### 2. 修改文件

#### `/frontend/src/views/OllamaApiDebugger.vue`
- **重构前**: 包含完整的 API 调试界面和逻辑（~400 行代码）
- **重构后**: 使用 `ApiDebugger` 组件，专注于 Ollama 特定逻辑（~150 行代码）
- **主要变化**:
  - 移除重复的 UI 代码
  - 保留左侧 API 列表和服务器选择
  - 使用 `handleRequest` 函数处理 Ollama 特定的请求逻辑
  - 通过 `setRequest` 方法设置 API 模板

## 技术实现

### 1. 组件通信

```typescript
// 父组件向子组件传递请求配置
apiDebuggerRef.value.setRequest({
  method: api.method,
  url: api.url,
  queryParams: api.queryParams,
  headers: api.headers,
  body: api.body
});

// 子组件通过自定义处理器回调父组件
const handleRequest = async (request) => {
  // 使用 Wails 的 SendHttpRequest
  const result = await SendHttpRequest(backendRequest);
  return result;
};
```

### 2. 数据结构

```typescript
interface ApiRequest {
  method: string;
  url: string;
  queryParams: KeyValue[];
  headers: KeyValue[];
  body: RequestBody;
}

interface KeyValue {
  key: string;
  value: string;
  enabled: boolean;
}

interface RequestBody {
  type: 'none' | 'raw' | 'formData';
  rawContent: string;
  rawContentType: string;
  formData: FormDataItem[];
}
```

### 3. 样式系统

- 使用 Tailwind CSS 风格的颜色系统
- 响应式设计，支持不同屏幕尺寸
- HTTP 方法颜色编码：
  - GET: 蓝色 (#61affe)
  - POST: 绿色 (#49cc90)
  - PUT: 橙色 (#fca130)
  - DELETE: 红色 (#f93e3e)
  - PATCH: 青色 (#50e3c2)
  - HEAD: 紫色 (#9012fe)

## 重构效果

### 1. 代码量减少
- **重构前**: OllamaApiDebugger.vue ~400 行
- **重构后**: 
  - OllamaApiDebugger.vue ~150 行
  - ApiDebugger.vue ~350 行
  - 总计减少约 100 行代码

### 2. 功能增强
- ✅ 支持自定义请求处理器
- ✅ 更好的 TypeScript 支持
- ✅ 组件可复用性
- ✅ 更清晰的代码结构

### 3. 维护性提升
- 🔧 UI 逻辑与业务逻辑分离
- 🔧 单一职责原则
- 🔧 更容易测试和调试
- 🔧 更好的扩展性

## 使用示例

### 基本使用
```vue
<template>
  <ApiDebugger 
    base-url="https://api.example.com"
    url-placeholder="/api/endpoint"
  />
</template>
```

### 高级使用
```vue
<template>
  <ApiDebugger 
    ref="debuggerRef"
    :base-url="serverUrl"
    :on-request="customRequestHandler"
  />
</template>

<script setup>
const customRequestHandler = async (request) => {
  // 自定义请求逻辑
  return await myApiClient.send(request);
};
</script>
```

## 兼容性

- ✅ Vue 3 Composition API
- ✅ TypeScript 支持
- ✅ Wails 框架兼容
- ✅ Element Plus 样式兼容

## 后续计划

1. **功能扩展**:
   - 添加请求历史记录
   - 支持环境变量
   - 添加测试用例生成
   - 支持批量请求

2. **性能优化**:
   - 虚拟滚动优化大量 API 列表
   - 响应数据懒加载
   - 请求缓存机制

3. **用户体验**:
   - 添加快捷键支持
   - 主题切换功能
   - 导入/导出配置

## 总结

本次重构成功地将 API 调试功能抽象为通用组件，在保持原有功能的基础上，大大提高了代码的可复用性和维护性。新的 `ApiDebugger` 组件可以轻松集成到其他项目中，为开发者提供强大的 API 调试工具。

重构遵循了以下设计原则：
- **单一职责**: 每个组件专注于特定功能
- **开闭原则**: 对扩展开放，对修改封闭
- **依赖倒置**: 通过接口而非具体实现进行交互
- **组合优于继承**: 通过组合实现功能复用

这次重构为项目的长期维护和扩展奠定了良好的基础。