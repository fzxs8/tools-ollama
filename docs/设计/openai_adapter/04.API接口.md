# 4. API 接口

本文档定义了 OpenAI 适配器功能所涉及的三类接口：公共 API、内部管理 API 和内部管理事件。

## 4.1. 公共 API (Public-Facing)

这是适配器服务启动后，暴露给外部客户端（如 LobeChat）的 API。

### 4.1.1. Chat Completions

- **路径**: `/v1/chat/completions`
- **方法**: `POST`
- **描述**: 接收并处理与 OpenAI `chat/completions` 兼容的请求。

### 4.1.2. 请求处理时序图

(时序图保持不变，此处省略...)

## 4.2. 内部管理 API (Wails-Bound)

这是通过 Wails 绑定到前端，供内部设置页面调用的 Go 方法。

### 4.2.1. 配置管理

- **`GetOpenAIAdapterConfig() (*OpenAIAdapterConfig, error)`**: 获取当前持久化存储的适配器配置。
- **`SaveOpenAIAdapterConfig(config OpenAIAdapterConfig) error`**: 保存用户在前端页面上修改的新配置。

### 4.2.2. 服务生命周期管理

- **`StartAdapterServer() error`**: 根据已保存的配置，启动 OpenAI 适配器服务。
- **`StopAdapterServer() error`**: 停止当前正在运行的 OpenAI 适配器服务。
- **`GetOpenAIAdapterStatus() (*OpenAIAdapterStatus, error)`**: 获取适配器服务当前的实时运行状态。

### 4.2.3. 数据获取

- **`GetOllamaServers() ([]types.OllamaServerConfig, error)`**: (复用) 获取用户在“Ollama 设置”中配置的所有服务器列表。
- **`GetAdapterAPIDocs() (map[string]string, error)`**: 获取 API 文档抽屉所需的内容。返回一个 map，其中 key 为文档标题（如“非流式请求”），value 为格式化后的 `curl` 命令示例字符串。

## 4.3. 内部管理事件 (Wails Events)

这是由 Go 后端主动推送到前端的事件，用于实现实时数据同步。

### 4.3.1. `openai-adapter-log`

- **方向**: Go -> Frontend
- **功能**: 用于将后端的实时日志推送到前端日志抽屉进行显示。
- **载荷 (Payload)**: `LogEntry` 对象。包含 `Timestamp`, `Level`, `Message` 字段。
- **前端监听**: 前端应使用 `runtime.EventsOn` 方法来监听此事件，并将接收到的日志条目追加到日志显示区域。

```typescript
// 前端监听示例
import { EventsOn } from "../../wailsjs/runtime";
import { LogEntry } from "../../wailsjs/go/models";

EventsOn("openai-adapter-log", (logEntry: LogEntry) => {
  // 将 logEntry 添加到日志显示列表中
});
```
