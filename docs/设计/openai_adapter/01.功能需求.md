# 1. 功能需求

## 1.1. 背景

为了提升 `duola-desktop` 的通用性和扩展性，我们计划开发一个 API 适配层，将 Ollama 的原生 API 转换为与 OpenAI `v1/chat/completions` 接口兼容的格式。为方便用户管理和使用此功能，除了核心的 API 转换能力，还需要提供一个风格统一、交互友好、功能强大的图形化管理界面。

## 1.2. 核心目标

1.  **后端**：构建一个稳定、可配置的中间服务，该服务能够将符合 OpenAI 规范的请求准确转发给用户指定的本地 Ollama 服务，并以兼容格式返回响应。同时，能够实时捕获并广播其处理日志。
2.  **前端**：提供一个视觉风格与 Ollama 官方统一、交互简洁高效的设置页面。用户不仅可以轻松管理服务的生命周期和运行参数，还可以实时监控服务日志并查阅 API 文档。

## 1.3. 功能点

### 1.3.1. API 适配核心功能

- **兼容 Chat Completions API**: 实现 `POST /v1/chat/completions` 接口。
- **支持流式与非流式响应**: 准确处理 `stream` 参数，返回 SSE 事件流或单个 JSON 对象。
- **协议转换**: 准确地在 OpenAI 和 Ollama 的消息格式之间进行转换。

### 1.3.2. 前端配置页面功能

- **视觉风格**:
    - 页面的整体 UI/UX 设计应参考 Ollama 官方应用的风格，确保视觉统一和现代感。

- **服务启停控制**:
    - 使用**单个切换按钮**来控制服务的“启动”与“停止”。
    - 按钮的文本和状态会根据服务当前是否运行而改变。
    - 按钮需要实现**防抖**机制，防止用户快速连续点击导致状态错乱。
    - 服务一旦启动，其生命周期应与 `duola-desktop` 主应用保持一致，除非用户手动停止，否则不会中断。

- **网络配置**:
    - 提供一个输入框，用于设置服务监听的 **IP 地址**，默认值为 `127.0.0.1`。
    - 提供一个输入框，用于设置服务监听的 **端口号**，默认值为 `11223`。

- **目标 Ollama 服务配置**:
    - 提供一个下拉选择框，动态加载用户在“Ollama 设置”中已配置的所有 Ollama 服务列表。

- **实时日志监控 (抽屉)**:
    - 提供一个“查看日志”按钮，点击后从右侧滑出抽屉面板。
    - 抽屉内**实时滚动显示**适配器接口的转发日志。
    - 日志有**最大长度限制**（如 500 行），以避免浏览器内存溢出。
    - 抽屉内提供“**清空日志**”和“**下载日志**”的功能按钮。

- **API 文档查阅 (抽屉)**:
    - 提供一个“查看 API”按钮，点击后从右侧滑出抽屉面板。
    - 抽屉内清晰展示适配器提供的所有 API 接口及其说明。
    - 所有 API 调用示例均以 **`curl` 命令**的形式提供，方便用户复制和测试。

### 1.3.3. 配置持久化

- 用户在前端页面上所做的所有网络配置（IP 地址、端口）和目标 Ollama 服务选择，都必须被持久化存储。
- 当应用重启后，前端页面应能自动加载并显示用户上一次的配置。
