# 6. 待办事项 (TODO)

根据最终确定的、包含全新 UI 和实时日志功能的实现方案，开发任务更新如下。

## 6.1. 后端开发任务

- [ ] **更新 `types/types.go`**:
    - [ ] 添加 `LogEntry` 结构体定义。

- [ ] **增强 `OpenAIAdapterManager`**:
    - [ ] 在 `NewOpenAIAdapterManager` 中，将加载失败时的默认端口更新为 `11223`。
    - [ ] 添加 `runtimeCtx context.Context` 字段。
    - [ ] 创建并实现 `WailsLogWriter` 结构体，使其作为 `io.Writer`，能通过 Wails Event `openai-adapter-log` 发送日志。
    - [ ] 在 `Start()` 方法中，为 `Adapter-Handler` 和 `Adapter-OllamaClient` 的日志记录器配置使用 `WailsLogWriter`。

- [ ] **改造 `app.go`**:
    - [ ] 在 `startup` 方法中，将 `ctx` 注入到 `adapterManager.runtimeCtx`。
    - [ ] 实现 `GetAdapterAPIDocs()` Wails 方法，用于动态生成包含当前 IP 和端口的 `curl` 命令字符串。

## 6.2. 前端开发任务

- [ ] **重构 `OpenAIAdapterSettings.vue`**:
    - [ ] **样式**: 彻底重写 `<style>` 部分，以匹配类似 Ollama 的简洁、现代、深色主题风格。
    - [ ] **布局**: 重写 `<template>` 部分，实现新的卡片式布局。
    - [ ] **启停按钮**: 实现单个切换按钮，包含“已停止”、“运行中”、“加载中”三种状态，并为其点击事件添加防抖处理。
    - [ ] **抽屉**: 添加两个 `el-drawer` 组件，分别用于“实时日志”和“API 文档”。
    - [ ] **日志抽屉实现**: 
        - 实现一个 `ref` 引用日志显示区域的 DOM 元素。
        - 实现日志的自动滚动到底部功能。
        - 实现“清空日志”按钮的逻辑。
        - 实现“下载日志”按钮的逻辑。
    - [ ] **API 抽屉实现**: 
        - 实现“查看 API”按钮的逻辑，点击后调用后端获取数据并打开抽屉。
        - 将从后端获取的 `curl` 示例渲染到代码块中。

- [ ] **增强 Pinia Store (`openaiAdapter.ts`)**:
    - [ ] **State**: 添加 `logs`, `isLogDrawerVisible`, `apiDocs`, `isApiDrawerVisible` 等新状态。
    - [ ] **Actions**: 
        - 创建 `addLog` action，并在其中实现环形缓冲区的逻辑（限制日志最大长度）。
        - 创建 `fetchApiDocs` action，用于调用后端的 `GetAdapterAPIDocs` 方法。

- [ ] **实现事件监听**: 
    - 在 `OpenAIAdapterSettings.vue` 的 `onMounted` 钩子中，调用 `runtime.EventsOn("openai-adapter-log", ...)` 来监听后端日志事件，并调用 store 的 `addLog` action。

## 6.3. 文件清理

- [ ] 删除 `02.API接口.md` (内容已迁移)。
- [ ] 删除 `04.实现方案.md` (内容已迁移)。
- [ ] 删除 `05.待办事项.md` (内容已迁移)。

## 6.4. 测试

- [ ] **UI 测试**: 验证新界面的布局、样式和响应式行为是否符合设计。
- [ ] **功能测试**: 
    - [ ] 测试统一启停按钮的各种状态切换和防抖功能。
    - [ ] 测试配置的保存和重载，特别是新的默认端口。
    - [ ] 测试日志抽屉的打开、关闭、清空和下载功能。
    - [ ] 测试 API 文档抽屉的打开和内容显示。
- [ ] **集成测试**: 
    - [ ] 启动服务后，在日志抽屉中验证是否能看到外部 `curl` 请求的实时日志。
    - [ ] 验证日志的环形缓冲区是否按预期工作。
