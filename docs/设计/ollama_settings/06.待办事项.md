# OllamaSettings 页面待办事项

## 近期重构与优化总结 (2025-09-12)

本次重构对服务配置管理进行了底层优化，显著提升了系统的健壮性和效率。

- **[后端] 优化存储方式**: 
  - **问题**: 以往将整个服务器列表存为一个JSON字符串，导致每次增删改都需要读写整个列表，效率低下。
  - **解决方案**: 重构了 `ollama_config.go`，改用哈希表（Hash Map）结构存储服务器列表。现在每个服务器都是一个独立的键值对，操作单个服务器配置时不再影响其他条目。

- **[后端] 实现无感数据迁移**:
  - **问题**: 存储方式变更后，需要兼容用户的旧数据。
  - **解决方案**: 在 `GetServers` 函数中内置了数据迁移逻辑。当检测到旧格式数据时，会自动将其转换为新的哈希表格式并写回，用户无感知，保证了平滑升级。

- **[后端] 移除“自动创建本地服务”逻辑**:
  - **问题**: 即使用户删除了所有服务，程序在下次启动时仍会自动创建一个“本地服务”，不符合用户预期。
  - **解决方案**: 移除了该“自作聪明”的逻辑。现在 `GetServers` 函数会如实反映存储状态，如果用户清空了列表，则返回空列表。

- **[前端] 统一空状态处理**:
  - **问题**: 当没有可用服务时，前端页面会报错或无提示。
  - **解决方案**: 统一了所有使用服务列表的页面的前端逻辑。当检测到服务列表为空时，会明确弹出 `ElMessage` 提示“没有配置任何Ollama服务。请在“服务设置”页面添加一个。”，并阻止后续的API请求，提升了用户体验。

- **[前端] 类型重构**:
  - **问题**: `OllamaSettings.vue` 中存在重复的本地 `ServerConfig` 接口定义，且前端需要扩展 `OllamaServerConfig` 以包含 `isTesting` 等 UI 状态。
  - **解决方案**: 移除了本地 `ServerConfig` 定义，直接使用 Wails 自动生成的 `types.OllamaServerConfig`。同时，定义了 `FrontendOllamaServerConfig` 接口（在 `src/classes/types.ts` 中），扩展了 `types.OllamaServerConfig` 并添加了 `isTesting` 属性，确保前端类型安全且与后端解耦。

## 已完成事项

- [x] 创建 OllamaSettings 页面文档目录结构
- [x] 编写功能需求文档
- [x] 编写界面设计文档
- [x] 编写数据结构文档
- [x] 编写 API 接口文档
- [x] 编写开发规范文档

## 待处理事项

### 功能完善
- [ ] 优化本地服务启动/停止功能实现
- [ ] 增加服务配置导入/导出功能
- [ ] 增加批量操作功能
- [ ] 增加服务分组管理功能
- [ ] 添加任意Ollama服务器时，获取并显示服务器的Ollama版本信息

### 界面优化
- [ ] 优化移动端适配
- [ ] 增加暗色主题支持
- [ ] 优化表单验证提示
- [ ] 增加操作快捷键支持

### 性能优化
- [ ] 实现服务列表虚拟滚动
- [ ] 优化连接测试并发处理
- [ ] 增加配置缓存机制
- [ ] 优化数据加载性能

### 错误处理
- [ ] 增加网络异常处理
- [ ] 增加超时处理机制
- [ ] 增加重试机制
- [ ] 优化错误提示信息

### 安全增强
- [ ] 增加 API 密钥加密存储
- [ ] 增加配置备份功能
- [ ] 增加操作日志记录
- [ ] 增加权限控制机制

### 测试完善
- [ ] 编写前端组件单元测试
- [ ] 编写后端接口单元测试
- [ ] 编写集成测试用例
- [ ] 编写性能测试用例

### 文档完善
- [ ] 编写用户使用手册
- [ ] 编写管理员配置指南
- [ ] 编写故障排除指南
- [ ] 编写 API 接口详细说明
- [ ] 编写最佳实践指南
