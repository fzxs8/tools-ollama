# OllamaSettings 页面功能需求

## 页面概述

OllamaSettings 页面用于管理 Ollama 服务配置，包括本地服务和远程服务的配置管理。用户可以通过该页面添加、编辑、删除和测试 Ollama 服务连接。

## 核心功能

### 1. 服务类型管理

#### 本地服务 (Local Service)
- 固定存在，不可删除
- 默认地址：http://localhost:11434
- 可修改服务地址
- 可测试连接状态
- 可设置为默认服务

#### 远程服务 (Remote Service)
- 可添加新服务
- 可编辑现有服务
- 可删除不需要的服务
- 可测试连接状态
- 可设置为默认服务
- 可配置 API 密钥

### 2. 服务配置管理

#### 添加服务
- 点击"添加服务"按钮打开抽屉表单
- 选择服务类型（本地/远程）
- 填写服务名称
- 填写服务地址
- 远程服务可填写 API 密钥
- 本地服务可设置自动启动选项

#### 编辑服务
- 通过操作下拉菜单选择"编辑"
- 修改服务配置信息
- 保存更新

#### 删除服务
- 通过操作下拉菜单选择"删除"
- 显示确认对话框
- 确认后删除服务

### 3. 服务状态管理

#### 设置默认服务
- 通过操作下拉菜单选择"设置默认"
- 将选中服务设置为默认服务
- 默认服务在其他页面中优先使用

#### 测试连接
- 通过操作下拉菜单选择"测试"
- 验证服务地址是否可达
- 显示测试结果状态

#### 本地服务启动/停止
- 本地服务支持启动/停止操作
- 通过操作下拉菜单切换状态

## 界面设计

### 主要组件

1. **服务列表**
   - 表格形式展示所有服务
   - 包含名称、服务地址、类型、测试状态等列
   - 每行提供操作下拉菜单

2. **操作下拉菜单**
   - 设置默认
   - 编辑
   - 测试
   - 启动/停止（仅本地服务）
   - 删除（仅远程服务）

3. **添加/编辑服务抽屉**
   - 服务类型选择（本地/远程）
   - 服务名称输入
   - 服务地址输入
   - API 密钥输入（仅远程服务）
   - 自动启动选项（仅本地服务）

## 数据结构

### 服务配置结构

```typescript
interface ServerConfig {
  id: string;           // 服务ID
  name: string;         // 服务名称
  baseUrl: string;     // 服务地址
  apiKey: string;      // API密钥（远程服务）
  isActive: boolean;   // 是否为默认服务
  testStatus: 'unknown' | 'success' | 'failed'; // 测试状态
  type: 'local' | 'remote'; // 服务类型
  isRunning: boolean;  // 是否运行中（本地服务）
  autoStart: boolean;   // 自动启动（本地服务）
}
```

## 交互逻辑

### 页面加载
1. 加载远程服务器列表
2. 自动测试所有服务连接状态

### 添加服务流程
1. 点击"添加服务"按钮
2. 打开抽屉表单
3. 填写服务信息
4. 点击保存前自动测试连接
5. 测试成功后保存配置
6. 关闭抽屉并刷新列表

### 编辑服务流程
1. 通过操作菜单选择"编辑"
2. 打开抽屉表单并填充现有信息
3. 修改服务信息
4. 点击保存前自动测试连接
5. 测试成功后更新配置
6. 关闭抽屉并刷新列表

### 删除服务流程
1. 通过操作菜单选择"删除"
2. 显示确认对话框
3. 确认后调用删除接口
4. 删除成功后刷新列表

## 状态管理

### 连接测试状态
- unknown: 未测试
- success: 连接成功
- failed: 连接失败

### 默认服务状态
- isActive: 标识是否为默认服务
- 本地服务和远程服务分别管理默认状态

## API 接口

### 前端调用的 Go 接口

1. `SaveOllamaServerConfig(baseUrl: string): Promise<void>`
   - 保存本地 Ollama 服务配置

2. `GetOllamaServerConfig(): Promise<string>`
   - 获取本地 Ollama 服务配置

3. `SaveRemoteServers(servers: ServerConfig[]): Promise<void>`
   - 保存远程服务器列表

4. `GetRemoteServers(): Promise<ServerConfig[]>`
   - 获取远程服务器列表

5. `AddRemoteServer(server: ServerConfig): Promise<void>`
   - 添加远程服务器

6. `UpdateRemoteServer(server: ServerConfig): Promise<void>`
   - 更新远程服务器

7. `DeleteRemoteServer(serverId: string): Promise<void>`
   - 删除远程服务器

8. `SetActiveServer(serverId: string): Promise<void>`
   - 设置活动服务器

9. `TestOllamaServer(baseUrl: string): Promise<void>`
   - 测试 Ollama 服务器连接

## 错误处理

### 网络错误
- 服务不可达时显示具体错误信息
- 提供重试机制

### 表单验证
- 服务名称和地址为必填项
- 地址格式验证

### 操作确认
- 删除操作需要用户确认
- 重要操作提供状态反馈

## 用户体验要求

### 界面反馈
- 操作成功后显示成功消息
- 操作失败后显示错误消息
- 加载过程中显示加载状态

### 自动化功能
- 页面加载时自动测试所有服务连接
- 保存配置前自动测试连接

### 状态同步
- 界面状态与后端存储保持同步
- 多设备间配置同步