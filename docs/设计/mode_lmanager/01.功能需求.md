# ModelManager 页面功能需求

## 页面概述

ModelManager 页面是 Ollama 模型管理工具的核心功能页面，用于管理本地和远程 Ollama 服务器上的大语言模型。用户可以通过该页面查看、运行、停止、测试和删除模型，以及配置模型参数。

## 核心功能

### 1. 多服务器支持

#### 服务器选择
- 提供下拉菜单选择当前操作的服务器。
- 支持本地服务和多个远程服务切换。
- 服务器切换时自动刷新模型列表。

#### 服务器状态同步
- **[已优化]** 页面加载时，应自动查询并默认选中在 `OllamaSettings` 页面中被设为"活动"的服务器。
- 如果未找到活动服务器或获取失败，则默认选中"本地服务"作为备选项。

### 2. 模型列表管理

#### 模型展示
- 以表格形式展示模型信息。
- 显示模型名称、大小、修改时间。
- 显示模型运行状态（运行中/未运行）。
- 提供刷新按钮更新模型列表。

#### 模型状态管理
- **[已优化]** Go后端是模型运行状态的唯一权威来源，确保刷新列表后，正在运行的模型的"运行中"状态不会丢失。
- 前端应直接使用后端返回的状态，无需进行二次处理。

### 3. 模型详情管理

#### 模型详情抽屉
- 点击"查看"按钮打开模型详情抽屉。
- 展示模型详细信息（名称、大小、修改时间、运行状态）。
- 提供模型操作按钮和参数配置表单。

#### 模型操作
- **运行模型**：
  - **[已优化]** 点击"运行"按钮后，按钮应立即进入加载状态（loading）并被禁用，以防止重复点击。
  - 启动请求完成后，按钮恢复正常状态。
  - **[已优化]** "运行"按钮与"停止"按钮应根据模型运行状态互斥显示。模型未运行时，显示"运行"；模型运行时，显示"停止"。
- **停止模型**：
  - **[已优化]** 点击"停止"按钮后，按钮应立即进入加载状态（loading）并被禁用，以防止重复点击。
  - 停止请求完成后，按钮恢复正常状态。
- **删除模型**：从服务器删除模型，并提供二次确认。
- **[已优化]** **测试模型**：
  - 测试功能区应布局在"模型参数"下方。
  - 提供一个文本输入框，允许用户输入自定义的测试内容（prompt）。
  - 提供一个"发送测试"按钮，点击后进入加载状态。
  - 在按钮下方提供一个美观的结果展示区（如卡片），用于清晰地显示模型的返回结果或错误信息。

### 4. 模型参数配置

#### 参数配置表单
- 提供温度（Temperature）滑块配置。
- 提供 Top P 滑块配置。
- 提供上下文大小数字输入框。
- 提供保存参数按钮。

#### 参数管理
- 加载模型默认参数或已保存参数。
- 支持保存参数配置。
- 参数在运行模型时应用。

### 5. 模型搜索功能

#### 搜索抽屉
- 点击"搜索模型"按钮打开搜索抽屉。
- 提供模型名称搜索输入框。
- 提供模型家族和标签筛选（待实现）。
- 搜索结果按模型家族分组展示。

#### 搜索结果
- 显示模型名称和大小。
- 提供下载按钮（待实现完整功能）。
- 支持从搜索结果刷新模型列表。

### 6. 模型下载功能

#### 下载流程
- **[已优化]** 用户可以通过模型搜索或手动输入模型名称来启动下载。
- **[已优化]** 下载请求发送到指定的Ollama服务器（本地或远程）。
- **[已优化]** 下载过程中实时显示进度信息。
- **[已优化]** 下载完成后自动刷新模型列表。

#### 错误处理
- **[已优化]** 能够正确识别和处理下载过程中的各种错误，包括：
  - 网络连接错误
  - 模型不存在错误
  - Ollama版本不兼容错误
  - 服务器内部错误
- **[已优化]** 出现错误时立即通知用户，而不是错误地报告下载完成。
- **[已优化]** 提供清晰的错误信息帮助用户理解问题原因。

### 7. 在线模型市场功能

#### 模型市场页面
- 提供独立的模型市场页面用于发现和下载在线模型
- 默认加载并显示热门在线模型列表
- 提供搜索功能，可以按模型名称搜索在线模型
- 显示模型的下载次数和更新时间等信息

#### 在线模型搜索
- 点击"搜索在线模型"按钮打开搜索抽屉
- 提供模型名称搜索输入框
- 实时显示搜索结果
- 提供从搜索结果直接下载模型的功能

#### 在线模型下载
- 支持从模型市场直接下载在线模型
- 显示下载进度
- 下载完成后自动刷新本地模型列表

## 数据结构

### 模型数据结构

```typescript
interface Model {
  name: string;              // 模型名称
  size: number;              // 模型大小（字节）
  modifiedAt: string;       // 修改时间（ISO格式）
  isRunning: boolean;       // [优化] 运行状态，由后端权威提供
}
```

## 交互逻辑

### 页面加载流程
1. **[优化]** 加载可用服务器列表（本地+远程）。
2. **[优化]** 调用后端接口，获取在"设置"中指定的活动服务器。
3. **[优化]** 将下拉列表的默认选中项设置为活动服务器，若无则默认为本地。
4. **[优化]** 根据选中的服务器，调用后端接口获取模型列表（列表已包含准确的运行状态）。
5. 加载搜索相关数据。

### 模型运行流程
1. 打开模型详情抽屉。
2. 点击"运行"按钮，按钮进入加载状态并禁用。
3. 调用 `RunModel` 接口。
4. 接口返回后，按钮恢复。
5. 成功后更新模型状态为"运行中"，并切换显示"停止"按钮。
6. 显示成功消息。

### 模型停止流程
1. 打开模型详情抽屉（模型处于运行状态）。
2. 点击"停止"按钮，按钮进入加载状态并禁用。
3. 调用 `StopModel` 接口。
4. 接口返回后，按钮恢复。
5. 成功后更新模型状态为"未运行"，并切换显示"运行"按钮。
6. 显示成功消息。

### 模型测试流程
1. 打开模型详情抽屉。
2. 在"测试内容"输入框中输入文本。
3. 点击"发送测试"按钮，按钮和结果区进入加载状态。
4. 调用 `TestModel` 接口，并传递自定义的测试内容。
5. 接口返回后，加载状态结束。
6. 在结果区显示模型返回的完整内容或错误信息。

## 状态管理

### 模型运行状态
- **[已优化]** Go后端通过内存中的 `runningModels` map 维护所有模型的运行状态，作为单一数据源。
- **[已优化]** 前端每次请求模型列表时，后端都会附加最新的运行状态，前端直接渲染即可。