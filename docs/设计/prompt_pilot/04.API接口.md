# PromptPilot API接口

**架构说明**: 本文档描述的“API接口”指的是前端Vue组件通过Wails框架直接调用的后端Go函数。

## 1. Prompt生成接口

### 1.1 生成Prompt
```
GeneratePrompt(idea string, models []string, serverId string) (map[string]string, error)
```
- **功能描述**: 根据用户想法、选定模型和服务生成Prompt

### 1.2 流式生成Prompt
```go
GeneratePromptStream(idea string, model string, serverId string) error
```
- **功能描述**: 流式生成单个模型的Prompt。生成内容将通过Wails事件流式发送到前端。
  - **数据流事件**: `prompt_pilot_stream` (类型: `string`, 每次发送一个数据块)
  - **完成事件**: `prompt_pilot_stream_done` (类型: `string`, 值为 "done", 表示流式生成完成)
  - **错误事件**: `prompt_pilot_stream_error` (类型: `string`, 包含错误信息，表示流式生成过程中发生错误)

## 2. Prompt优化接口

### 2.1 优化Prompt
```
OptimizePrompt(content string, feedback string, model string, serverId string) (string, error)
```
- **功能描述**: 根据用户反馈优化Prompt

### 2.2 批量优化Prompt
```
OptimizePromptBatch(content string, feedback string, models []string, serverId string) (map[string]string, error)
```
- **功能描述**: 使用多个模型并行优化Prompt

## 3. Prompt管理接口

### 3.1 获取Prompt列表
```
ListPrompts() ([]Prompt, error)
```
- **功能描述**: 获取所有已保存的Prompt列表

### 3.2 获取Prompt详情
```
GetPrompt(id string) (Prompt, error)
```
- **功能描述**: 根据ID获取Prompt详情

### 3.3 保存Prompt
```
SavePrompt(prompt Prompt) (Prompt, error)
```
- **功能描述**: 保存Prompt

### 3.4 更新Prompt
```
UpdatePrompt(prompt Prompt) (Prompt, error)
```
- **功能描述**: 更新Prompt

### 3.5 删除Prompt
```
DeletePrompt(id string) error
```
- **功能描述**: 根据ID删除Prompt

## 4. 模型与服务接口

**调用说明**: 此处列出的函数是`PromptPilot`模块为了实现服务和模型选择功能，而调用的由 **`main/App.go`** 提供的应用级公共函数。这种设计确保了Ollama服务的配置在整个应用中是统一的。

### 4.1 获取模型列表
```
ListModelsByServer(serverId string) ([]Model, error)
```
- **功能描述**: 根据服务器ID获取模型列表

### 4.2 获取服务器列表
```
GetServers() ([]Server, error)
```
- **功能描述**: 获取所有配置的服务器列表

### 4.3 测试服务器连接
```
TestServerConnection(server Server) (bool, error)
```
- **功能描述**: 测试服务器连接状态

### 4.4 获取激活的服务器
```
GetActiveServer() (Server, error)
```
- **功能描述**: 获取当前激活的服务器

## 5. 系统接口

### 5.1 获取用户配置
```
GetUserConfig() (map[string]interface{}, error)
```
- **功能描述**: 获取用户配置信息

### 5.2 保存用户配置
```
SaveUserConfig(config map[string]interface{}) error
```
- **功能描述**: 保存用户配置信息

## 6. 接口调用规范

### 6.1 错误处理规范
- 所有接口都应有明确的错误返回

### 6.2 数据传输规范
- 所有接口的请求和响应数据传输使用JSON格式。
- **例外**: `prompt_pilot_stream` 事件的数据为纯文本字符串（数据块）。

### 6.3 安全规范
- 敏感信息（如API密钥）不应在日志中明文记录

### 6.4 性能规范
- 接口响应时间应控制在合理范围内

## 7. 已实现接口状态

以下接口已在后端实现：
- GeneratePrompt
- GeneratePromptStream
- OptimizePrompt
- SavePrompt
- ListPrompts
- GetPrompt
- DeletePrompt
- ListModelsByServer
- GetServers
- TestServerConnection
