# PromptPilot API接口

## 1. Prompt生成接口

### 1.1 生成Prompt
```
GeneratePrompt(idea string, models []string, serverId string) (map[string]string, error)
```
- **功能描述**: 根据用户想法、选定模型和服务生成Prompt
- **请求方法**: POST
- **请求参数**:
  - idea: 用户输入的想法或需求描述
  - models: 选中的模型列表（最多3个）
  - serverId: 选中的服务ID
- **返回值**: 
  - map[string]string: 模型名称到生成Prompt的映射
  - error: 错误信息
- **处理流程**:
  1. 验证输入参数有效性
  2. 验证服务ID有效性
  3. 并行调用各模型生成Prompt
  4. 收集各模型生成结果
  5. 返回结果映射

### 1.2 流式生成Prompt
```
GeneratePromptStream(idea string, model string, serverId string) (stream, error)
```
- **功能描述**: 流式生成单个模型的Prompt
- **请求方法**: POST
- **请求参数**:
  - idea: 用户输入的想法或需求描述
  - model: 选中的模型
  - serverId: 选中的服务ID
- **返回值**:
  - stream: 流式数据
  - error: 错误信息
- **处理流程**:
  1. 验证输入参数有效性
  2. 验证服务ID有效性
  3. 调用模型流式生成Prompt
  4. 实时返回生成内容

## 2. Prompt优化接口

### 2.1 优化Prompt
```
OptimizePrompt(content string, feedback string, model string, serverId string) (string, error)
```
- **功能描述**: 根据用户反馈优化Prompt
- **请求方法**: POST
- **请求参数**:
  - content: 当前Prompt内容
  - feedback: 用户优化反馈
  - model: 使用的模型
  - serverId: 使用的服务ID
- **返回值**:
  - string: 优化后的Prompt内容
  - error: 错误信息
- **处理流程**:
  1. 验证输入参数有效性
  2. 验证服务ID有效性
  3. 构造优化请求
  4. 调用模型进行优化
  5. 返回优化结果

### 2.2 批量优化Prompt
```
OptimizePromptBatch(content string, feedback string, models []string, serverId string) (map[string]string, error)
```
- **功能描述**: 使用多个模型并行优化Prompt
- **请求方法**: POST
- **请求参数**:
  - content: 当前Prompt内容
  - feedback: 用户优化反馈
  - models: 使用的模型列表
  - serverId: 使用的服务ID
- **返回值**:
  - map[string]string: 模型名称到优化结果的映射
  - error: 错误信息
- **处理流程**:
  1. 验证输入参数有效性
  2. 验证服务ID有效性
  3. 并行调用各模型进行优化
  4. 收集优化结果
  5. 返回结果映射

## 3. Prompt管理接口

### 3.1 获取Prompt列表
```
ListPrompts() ([]Prompt, error)
```
- **功能描述**: 获取所有已保存的Prompt列表
- **请求方法**: GET
- **请求参数**: 无
- **返回值**:
  - []Prompt: Prompt列表
  - error: 错误信息
- **处理流程**:
  1. 从存储中获取所有Prompt
  2. 按时间倒序排列
  3. 返回Prompt列表

### 3.2 获取Prompt详情
```
GetPrompt(id string) (Prompt, error)
```
- **功能描述**: 根据ID获取Prompt详情
- **请求方法**: GET
- **请求参数**:
  - id: Prompt ID
- **返回值**:
  - Prompt: Prompt对象
  - error: 错误信息
- **处理流程**:
  1. 验证ID有效性
  2. 从存储中获取Prompt
  3. 返回Prompt详情

### 3.3 保存Prompt
```
SavePrompt(prompt Prompt) (Prompt, error)
```
- **功能描述**: 保存Prompt
- **请求方法**: POST
- **请求参数**:
  - prompt: Prompt对象
- **返回值**:
  - Prompt: 保存后的Prompt对象
  - error: 错误信息
- **处理流程**:
  1. 验证Prompt对象有效性
  2. 生成ID（新Prompt）
  3. 设置时间戳
  4. 保存到存储
  5. 返回保存结果

### 3.4 更新Prompt
```
UpdatePrompt(prompt Prompt) (Prompt, error)
```
- **功能描述**: 更新Prompt
- **请求方法**: PUT
- **请求参数**:
  - prompt: Prompt对象
- **返回值**:
  - Prompt: 更新后的Prompt对象
  - error: 错误信息
- **处理流程**:
  1. 验证Prompt对象有效性
  2. 验证ID存在性
  3. 更新时间戳
  4. 更新存储
  5. 返回更新结果

### 3.5 删除Prompt
```
DeletePrompt(id string) error
```
- **功能描述**: 根据ID删除Prompt
- **请求方法**: DELETE
- **请求参数**:
  - id: Prompt ID
- **返回值**:
  - error: 错误信息
- **处理流程**:
  1. 验证ID有效性
  2. 从存储中删除Prompt
  3. 返回操作结果

## 4. 模型与服务接口

### 4.1 获取模型列表
```
ListModelsByServer(serverId string) ([]Model, error)
```
- **功能描述**: 根据服务器ID获取模型列表
- **请求方法**: GET
- **请求参数**:
  - serverId: 服务器ID
- **返回值**:
  - []Model: 模型列表
  - error: 错误信息
- **处理流程**:
  1. 验证服务器ID有效性
  2. 调用服务器API获取模型列表
  3. 返回模型列表

### 4.2 获取服务器列表
```
GetServers() ([]Server, error)
```
- **功能描述**: 获取所有配置的服务器列表
- **请求方法**: GET
- **请求参数**: 无
- **返回值**:
  - []Server: 服务器列表
  - error: 错误信息
- **处理流程**:
  1. 从配置中读取服务器信息
  2. 返回服务器列表

### 4.3 测试服务器连接
```
TestServerConnection(server Server) (bool, error)
```
- **功能描述**: 测试服务器连接状态
- **请求方法**: POST
- **请求参数**:
  - server: 服务器对象
- **返回值**:
  - bool: 连接是否成功
  - error: 错误信息
- **处理流程**:
  1. 构造测试请求
  2. 发送测试请求到服务器
  3. 返回测试结果

### 4.4 获取激活的服务器
```
GetActiveServer() (Server, error)
```
- **功能描述**: 获取当前激活的服务器
- **请求方法**: GET
- **请求参数**: 无
- **返回值**:
  - Server: 服务器对象
  - error: 错误信息
- **处理流程**:
  1. 从配置中读取激活的服务器信息
  2. 返回服务器对象

## 5. 系统接口

### 5.1 获取用户配置
```
GetUserConfig() (map[string]interface{}, error)
```
- **功能描述**: 获取用户配置信息
- **请求方法**: GET
- **请求参数**: 无
- **返回值**:
  - map[string]interface{}: 用户配置
  - error: 错误信息
- **处理流程**:
  1. 从存储中读取用户配置
  2. 返回配置信息

### 5.2 保存用户配置
```
SaveUserConfig(config map[string]interface{}) error
```
- **功能描述**: 保存用户配置信息
- **请求方法**: POST
- **请求参数**:
  - config: 用户配置
- **返回值**:
  - error: 错误信息
- **处理流程**:
  1. 验证配置有效性
  2. 保存到存储
  3. 返回操作结果

## 6. 接口调用规范

### 6.1 错误处理规范
- 所有接口都应有明确的错误返回
- 错误信息应包含错误码和描述
- 前端应统一处理错误信息
- 记录关键错误日志便于调试

### 6.2 数据传输规范
- 使用JSON格式进行数据传输
- 时间戳使用Unix时间戳格式
- 字符串数据应进行适当的转义处理
- 大数据传输应考虑分页或流式处理

### 6.3 安全规范
- 敏感信息（如API密钥）不应在日志中明文记录
- 接口调用应有适当的权限验证
- 数据传输应考虑加密处理
- 防止注入攻击和XSS攻击

### 6.4 性能规范
- 接口响应时间应控制在合理范围内
- 大量数据处理应考虑异步处理
- 提供适当的缓存机制
- 对频繁调用的接口进行性能优化