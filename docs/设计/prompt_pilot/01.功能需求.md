# PromptPilot功能需求

## 模块概述

PromptPilot是一个专门用于提示词工程的模块，帮助用户创建、优化和管理提示词。该模块提供直观的界面让用户能够快速生成初始提示词，对其进行调优，并支持多模型对比测试，以找到最佳的提示词配置。

## 核心功能

### 1. 提示词生成
- **想法输入**: 用户可以输入一个想法或需求描述。
- **服务与模型选择**: 用户可选择已配置的Ollama服务，并从该服务下选择一个或多个模型（最多3个）。
- **并行流式生成**: 点击「生成」按钮，系统将为每个选定的模型 **并行、独立地** 调用后端流式生成接口。
- **单个模型重新生成**: 在每个模型生成结果的标签页内，提供一个独立的「重新生成」按钮，允许用户只针对当前模型再次生成内容，而不影响其他模型的结果。

### 2. 事件驱动的流式生成架构
为了实现前端与后端的解耦和健壮的通信，流式生成采用事件总线（Event Bus）模式。
- **前端职责**: 仅负责调用后端的`GeneratePromptStream`函数来 **触发** 一个生成任务，不直接处理返回的数据流。
- **后端职责**: 在接收到生成指令后，在后台执行任务，并通过Wails事件系统向前端 **广播** 以下三种事件：
  - **`prompt_pilot_stream`**: 在生成过程中，每当获得一小段新的文本（`chunk`）时触发，并附带模型名称和文本内容。
  - **`prompt_pilot_stream_error`**: 若某个模型的生成过程发生错误，则触发此事件，并附带模型名称和错误信息。
  - **`prompt_pilot_stream_done`**: 当某个模型成功完成所有内容的生成后，触发此事件，并附带模型名称。
- **前端监听**: 前端在组件挂载时（`onMounted`）会注册对这三个事件的全局监听器，并根据收到的事件来更新界面（追加文本、显示错误、更新加载状态等）。

### 3. 提示词管理 (CRUD)

#### 保存 (Create/Update)
- **触发**: 用户点击主界面右下角的「保存」按钮，或在“我的提示词”列表中点击Prompt的「编辑」按钮，打开“保存/编辑Prompt”抽屉。
- **抽屉标题**: 抽屉标题会根据操作类型动态显示：新建时为“保存Prompt”，编辑时为“编辑 “XXX””（XXX为Prompt名称）。
- **数据预填充**: 
  - **标题**: 抽屉打开时，系统会自动截取用户在主输入框中“想法”的前20个字符，作为默认标题（新建模式下），用户可修改。
  - **内容**: 保存时，系统将获取 **当前激活的标签页** 中的Prompt内容作为要保存的核心`content`。
  - **编辑模式**: 当点击「编辑」时，会将选中Prompt的所有信息（包括ID、名称、描述、标签、内容、关联模型等）完整填充到表单中。
- **用户输入**: 在抽屉中，用户可以：
  - 编辑预填充的 **标题** (必填)。
  - 填写详细的 **描述** (选填)。
  - 添加一个或多个 **标签** (选填)，支持从现有标签中选择，也支持动态创建新标签。
  - **关联模型**: 只读显示当前Prompt关联的模型列表。
  - **内容预览**: 只读显示Prompt的完整内容，并提供一个 **复制按钮** 方便用户复制。
- **后端调用**: 前端将组装好的`Prompt`对象发送给后端的`SavePrompt`函数进行持久化。后端会根据`Prompt`对象是否包含ID来判断是创建新Prompt还是更新已有Prompt。
- **交互反馈**: 保存成功后，会显示成功提示（“Prompt保存成功”或“Prompt更新成功”），并自动关闭抽屉、刷新“我的提示词”列表。

#### 读取 (Read)
- 组件挂载时会自动获取所有已保存的Prompt列表，并在“我的提示词”抽屉中展示。

#### 删除 (Delete)
- 用户可以删除不需要的Prompt。在执行删除操作前，会弹出一个确认对话框（`ElMessageBox.confirm`），提示文案为“您确定要删除 “XXX” 吗？”（XXX为Prompt名称），防止误操作。

#### 预览 (Preview)
- 在“我的提示词”列表中，用户可以将某个已存Prompt的内容一键加载到当前视图中，方便快速复用和修改。

### 4. 提示词调优
- **快速优化**: 用户可以对当前生成的Prompt进行快速优化。
- **反馈机制**: 用户提供优化反馈，系统基于反馈进一步优化Prompt。

## 用户交互流程

1. 用户在输入框中输入想法。
2. 用户选择一个Ollama服务，然后选择一个或多个模型（最多3个）。
3. 用户点击「生成」按钮。
4. 界面上，所有选定模型的标签页内容被清空，并显示“正在生成...”的加载动画。主「生成」按钮和其他相关按钮被禁用。
5. 前端通过监听`prompt_pilot_stream`事件，将后端陆续发来的文本块追加到对应模型的显示区域，形成打字机效果。
6. 当某个模型生成完毕（收到`prompt_pilot_stream_done`事件）或出错（收到`prompt_pilot_stream_error`事件），其标签页内的加载动画停止。
7. 当 **所有** 模型都完成后，主「生成」按钮和相关按钮恢复可用状态。
8. 用户可以点击某个模型标签页内的「重新生成」按钮，只刷新这一个模型的内容。
9. 用户对结果满意后，可点击「保存」按钮，在弹出的抽屉中为Prompt命名、添加描述和标签后进行保存。
10. 用户可随时点击「我的提示词」按钮，在抽屉中查看、预览、编辑或删除所有已保存的Prompt。
