# PromptPilot功能需求

## 模块概述

PromptPilot是一个专门用于提示词工程的模块，帮助用户创建、优化和管理提示词。该模块提供直观的界面让用户能够快速生成初始提示词，对其进行调优，并支持多模型对比测试，以找到最佳的提示词配置。

## 核心功能

### 1. 提示词生成
- **想法输入**: 用户可以输入一个想法或需求描述。
- **服务与模型选择**: 用户可选择已配置的Ollama服务，并从该服务下选择一个或多个模型（最多3个）。
- **并行流式生成**: 点击「生成」按钮，系统将为每个选定的模型 **并行、独立地** 调用后端流式生成接口。
- **单个模型重新生成**: 在每个模型生成结果的标签页内，提供一个独立的「重新生成」按钮，允许用户只针对当前模型再次生成内容，而不影响其他模型的结果。

### 2. 事件驱动的流式生成架构
为了实现前端与后端的解耦和健壮的通信，流式生成采用事件总线（Event Bus）模式。
- **前端职责**: 仅负责调用后端的`GeneratePromptStream`函数来 **触发** 一个生成任务，不直接处理返回的数据流。
- **后端职责**: 在接收到生成指令后，在后台执行任务，并通过Wails事件系统向前端 **广播** 以下三种事件：
  - **`prompt_pilot_stream`**: 在生成过程中，每当获得一小段新的文本（`chunk`）时触发，并附带模型名称和文本内容。
  - **`prompt_pilot_stream_error`**: 若某个模型的生成过程发生错误，则触发此事件，并附带模型名称和错误信息。
  - **`prompt_pilot_stream_done`**: 当某个模型成功完成所有内容的生成后，触发此事件，并附带模型名称。
- **前端监听**: 前端在组件挂载时（`onMounted`）会注册对这三个事件的全局监听器，并根据收到的事件来更新界面（追加文本、显示错误、更新加载状态等）。

### 3. 提示词管理 (CRUD)

#### 保存 (Create)
- **触发**: 用户点击主界面右下角的「保存」按钮，打开“保存Prompt”抽屉。
- **数据预填充**: 抽屉打开时，系统会自动截取用户在主输入框中“想法”的前20个字符作为默认标题，并将当前激活标签页的Prompt内容和关联模型填充到表单中。
- **用户输入**: 在抽屉中，用户可以编辑标题、填写描述、添加标签。
- **后端调用**: 点击“确认保存”后，前端将组装好的`Prompt`对象（不含ID）发送给后端的`SavePrompt`函数进行持久化。

#### 读取 (Read)
- **触发**: 点击主界面右下角的「我的提示词」按钮，打开“我的提示词”抽屉。
- **功能**: 组件挂载时会自动调用`ListPrompts`获取所有已保存的Prompt列表，并在抽屉中展示。

#### 更新 (Update)
- **触发**: 在“我的提示词”列表中，点击某个Prompt的「编辑」按钮。
- **界面**: 打开一个标题为“编辑 “XXX””（XXX为Prompt名称）的抽屉，并将该Prompt的所有信息完整填充到表单中。
- **后端调用**: 点击“确认保存”后，前端将组装好的、**包含ID**的`Prompt`对象发送给后端的`SavePrompt`函数。后端根据ID存在来执行更新逻辑。

#### 删除 (Delete)
- **触发**: 在“我的提示词”列表中，点击某个Prompt的「删除」按钮。
- **交互**: 在执行删除操作前，会弹出一个确认对话框，提示文案为“您确定要删除 “XXX” 吗？”（XXX为Prompt名称），防止误操作。

#### 列表功能增强
- **预览**: 在“我的提示词”列表中，点击「预览」可将该Prompt内容一键加载到主界面的当前视图中。
- **复制**: 在“我的提示词”列表中，每个Prompt的内容预览区右上角提供一个「复制」按钮，方便快速复制完整Prompt内容。

## 用户交互流程

1. 用户在输入框中输入想法。
2. 用户选择一个Ollama服务，然后选择一个或多个模型（最多3个）。
3. 用户点击「生成」按钮。
4. 界面上，所有选定模型的标签页内容被清空，并显示“正在生成...”的加载动画。主「生成」按钮和其他相关按钮被禁用。
5. 前端通过监听`prompt_pilot_stream`事件，将后端陆续发来的文本块追加到对应模型的显示区域，形成打字机效果。
6. 当某个模型生成完毕或出错，其标签页内的加载动画停止。
7. 当 **所有** 模型都完成后，主「生成」按钮和相关按钮恢复可用状态。
8. 用户可以点击某个模型标签页内的「重新生成」按钮，只刷新这一个模型的内容。
9. 用户对结果满意后，可点击「保存」按钮，在弹出的抽屉中为Prompt命名、添加描述和标签后进行保存。
10. 用户可随时点击「我的提示词」按钮，在抽屉中查看、预览、编辑、删除或复制所有已保存的Prompt。
