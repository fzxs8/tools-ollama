# PromptPilot数据结构

## 1. 核心数据结构 (Go & TypeScript)

**说明**: 以下是后端 Go 代码中定义的核心结构体。Wails 会自动根据这些 Go 结构体生成对应的 TypeScript 类型，因此这份定义是前后端唯一的真实数据源。

### 1.1 Prompt 对象

```go
// a/tools-ollama/prompt_pilot.go
type Prompt struct {
	ID          string   `json:"id"`          // 唯一标识符 (UUID)
	Name        string   `json:"name"`        // Prompt名称
	Content     string   `json:"content"`     // Prompt内容
	Description string   `json:"description"` // 描述信息
	CreatedAt   int64    `json:"createdAt"`   // 创建时间戳 (毫秒)
	UpdatedAt   int64    `json:"updatedAt"`   // 更新时间戳 (毫秒)
	Models      []string `json:"models"`      // 使用的模型列表
	Version     int      `json:"version"`     // 版本号
	Tags        []string `json:"tags"`        // 标签列表
	CreatedBy   string   `json:"createdBy"`   // 创建者标识
}
```

### 1.2 Server 对象

```go
// a/tools-ollama/prompt_pilot.go
type Server struct {
	ID         string `json:"id"`          // 服务ID (本地服务为 "local")
	Name       string `json:"name"`        // 服务名称
	BaseURL    string `json:"base_url"`    // 服务地址
	APIKey     string `json:"api_key"`     // API密钥 (远程服务)
	IsActive   bool   `json:"is_active"`   // 是否为默认服务
	TestStatus string `json:"test_status"` // 测试状态 (如: "success", "failed")
	Type       string `json:"type"`        // 服务类型 ("local" 或 "remote")
}
```

## 2. 后端事件数据结构

**说明**: 后端通过 Wails 的事件系统与前端进行流式通信。以下是定义的三种事件及其数据负载（Payload）的 TypeScript 接口。

### 2.1 `prompt_pilot_stream`

- **触发时机**: 在流式生成过程中，每当后端获得一小段新的文本块（chunk）时触发。
- **数据结构**:
  ```typescript
  interface StreamData {
    model: string;  // 产生该数据块的模型名称
    chunk: string;  // 新生成的文本数据块
  }
  ```

### 2.2 `prompt_pilot_stream_error`

- **触发时机**: 当某个模型的生成过程发生错误时触发。
- **数据结构**:
  ```typescript
  interface StreamErrorData {
    model: string; // 发生错误的模型名称
    error: string; // 详细的错误信息
  }
  ```

### 2.3 `prompt_pilot_stream_done`

- **触发时机**: 当某个模型成功完成所有内容的生成时触发。
- **数据结构**:
  ```typescript
  interface StreamDoneData {
    model: string; // 已完成生成的模型名称
  }
  ```

## 3. 存储设计

- **存储方式**: 使用 `duolasdk` 的哈希存储（HSet/HGetAll）功能。
- **主键 (Key)**: `"prompts"`
- **字段 (Field)**:
  - **字段名**: 每个 Prompt 的 `ID` (UUID)。
  - **字段值**: 完整的 `Prompt` 对象经过 JSON 序列化后的字符串。
