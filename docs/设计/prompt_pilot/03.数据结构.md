# PromptPilot数据结构

## 1. 前端数据结构

### 1.1 Prompt对象 (Prompt)
```typescript
interface Prompt {
  id: string;              // 唯一标识符 (UUID)
  name: string;            // Prompt名称
  content: string;         // Prompt内容
  description: string;     // 描述信息（可选）
  createdAt: number;       // 创建时间戳
  updatedAt: number;       // 更新时间戳
  models: string[];        // 使用的模型列表
  serverId: string;        // 使用的服务ID
  version: number;         // 版本号
  tags: string[];          // 标签列表
  createdBy: string;       // 创建者标识
}
```

### 1.2 Prompt草稿对象 (PromptDraft)
```typescript
interface PromptDraft {
  idea: string;            // 用户输入的想法
  content: string;         // 生成的Prompt内容
  selectedModels: string[]; // 选中的模型列表
  selectedServerId: string; // 选中的服务ID
  generationStatus: 'idle' | 'generating' | 'completed' | 'error'; // 生成状态
  optimizationHistory: OptimizationRecord[]; // 优化历史记录
}
```

### 1.3 优化记录对象 (OptimizationRecord)
```typescript
interface OptimizationRecord {
  id: string;              // 记录ID
  timestamp: number;       // 优化时间
  feedback: string;        // 用户反馈
  previousContent: string; // 优化前内容
  optimizedContent: string; // 优化后内容
  model: string;           // 使用的模型
  serverId: string;        // 使用的服务ID
}
```

### 1.4 模型对象 (Model)
```typescript
interface Model {
  name: string;            // 模型名称
  size: number;            // 模型大小（字节）
  modifiedAt: string;      // 修改时间
  digest: string;          // 模型摘要
  details: ModelDetails;   // 模型详细信息
}
```

### 1.5 模型详情对象 (ModelDetails)
```typescript
interface ModelDetails {
  parent: string;          // 父模型
  format: string;          // 模型格式
  family: string;          // 模型家族
  families: string[];      // 模型家族列表
  parameterSize: string;   // 参数大小
  quantizationLevel: string; // 量化级别
}
```

### 1.6 服务对象 (Server)
```typescript
interface Server {
  id: string;              // 服务ID
  name: string;            // 服务名称
  baseUrl: string;         // 基础URL
  apiKey: string;          // API密钥
  isActive: boolean;       // 是否激活
  testStatus: string;      // 测试状态
  type: string;            // 服务类型
}
```

### 1.7 标签对象 (Tag)
```typescript
interface Tag {
  id: string;              // 标签ID
  name: string;            // 标签名称
  createdAt: number;       // 创建时间
  updatedAt: number;       // 更新时间
  createdBy: string;       // 创建者标识
}
```

## 2. 后端数据结构

### 2.1 Prompt结构 (Prompt)
```go
type Prompt struct {
	ID          string    `json:"id"`          // 唯一标识符
	Name        string    `json:"name"`        // Prompt名称
	Content     string    `json:"content"`     // Prompt内容
	Description string    `json:"description"` // 描述信息
	CreatedAt   int64     `json:"createdAt"`   // 创建时间戳
	UpdatedAt   int64     `json:"updatedAt"`   // 更新时间戳
	Models      []string  `json:"models"`      // 使用的模型列表
	ServerID    string    `json:"serverId"`    // 使用的服务ID
	Version     int       `json:"version"`     // 版本号
	Tags        []string  `json:"tags"`        // 标签列表
	CreatedBy   string    `json:"createdBy"`   // 创建者标识
}
```

### 2.2 Prompt草稿结构 (PromptDraft)
```go
type PromptDraft struct {
	Idea              string               `json:"idea"`              // 用户输入的想法
	Content           string               `json:"content"`           // 生成的Prompt内容
	SelectedModels    []string             `json:"selectedModels"`    // 选中的模型列表
	SelectedServerID  string               `json:"selectedServerId"`  // 选中的服务ID
	GenerationStatus  string               `json:"generationStatus"`  // 生成状态
	OptimizationHistory []OptimizationRecord `json:"optimizationHistory"` // 优化历史记录
}
```

### 2.3 优化记录结构 (OptimizationRecord)
```go
type OptimizationRecord struct {
	ID               string `json:"id"`               // 记录ID
	Timestamp        int64  `json:"timestamp"`        // 优化时间
	Feedback         string `json:"feedback"`         // 用户反馈
	PreviousContent  string `json:"previousContent"`  // 优化前内容
	OptimizedContent string `json:"optimizedContent"` // 优化后内容
	Model            string `json:"model"`            // 使用的模型
	ServerID         string `json:"serverId"`         // 使用的服务ID
}
```

### 2.4 模型结构 (Model)
```go
type Model struct {
	Name       string       `json:"name"`       // 模型名称
	Size       int64        `json:"size"`       // 模型大小
	ModifiedAt string       `json:"modified_at"`// 修改时间
	Digest     string       `json:"digest"`     // 模型摘要
	Details    ModelDetails `json:"details"`    // 模型详细信息
}
```

### 2.5 模型详情结构 (ModelDetails)
```go
type ModelDetails struct {
	Parent            string   `json:"parent"`             // 父模型
	Format            string   `json:"format"`             // 模型格式
	Family            string   `json:"family"`             // 模型家族
	Families          []string `json:"families"`           // 模型家族列表
	ParameterSize     string   `json:"parameter_size"`     // 参数大小
	QuantizationLevel string   `json:"quantization_level"` // 量化级别
}
```

### 2.6 服务结构 (Server)
```go
type Server struct {
	ID         string `json:"id"`          // 服务ID
	Name       string `json:"name"`        // 服务名称
	BaseURL    string `json:"base_url"`    // 基础URL
	APIKey     string `json:"api_key"`     // API密钥
	IsActive   bool   `json:"is_active"`   // 是否激活
	TestStatus string `json:"test_status"` // 测试状态
	Type       string `json:"type"`        // 服务类型
}
```

### 2.7 标签结构 (Tag)
```go
type Tag struct {
	ID        string `json:"id"`        // 标签ID
	Name      string `json:"name"`      // 标签名称
	CreatedAt int64  `json:"createdAt"` // 创建时间
	UpdatedAt int64  `json:"updatedAt"` // 更新时间
	CreatedBy string `json:"createdBy"` // 创建者标识
}
```

## 3. 存储设计

### 3.1 Prompt存储
- **存储方式**: 使用duolasdk的哈希存储功能
- **主键**: "prompts"
- **字段**: 
  - 字段名为Prompt的ID
  - 值为JSON序列化的Prompt对象

### 3.2 Prompt草稿存储
- **存储方式**: 使用duolasdk的键值存储功能
- **键名**: "prompt_draft"
- **值**: JSON序列化的PromptDraft对象

### 3.3 用户配置存储
- **存储方式**: 使用duolasdk的键值存储功能
- **键名**: "prompt_user_config"
- **值**: JSON序列化的用户配置对象

### 3.4 优化历史存储
- **存储方式**: 作为Prompt对象的一部分存储
- **关联**: 与对应的Prompt ID关联
- **结构**: 优化记录数组

### 3.5 标签存储
- **存储方式**: 使用duolasdk的哈希存储功能
- **主键**: "tags"
- **字段**: 
  - 字段名为标签的ID
  - 值为JSON序列化的标签对象

## 4. 数据交互规范

### 4.1 数据传输格式
- 所有数据传输使用JSON格式
- 时间戳使用Unix时间戳（秒级）
- 字符串数据需进行适当的转义处理
- 大数据传输考虑分页或流式处理

### 4.2 数据验证规范
- 所有输入数据需进行有效性验证
- Prompt名称不能为空且长度限制在100字符以内
- Prompt内容长度限制在10000字符以内
- 模型列表不能为空且最多支持3个模型
- 标签名称不能为空且长度限制在20字符以内
- 服务ID不能为空

### 4.3 数据一致性保证
- 写入操作使用事务机制确保数据一致性
- 提供数据校验机制防止损坏数据
- 支持数据恢复机制应对异常情况
- 定期备份重要数据

## 5. 数据安全规范

### 5.1 数据加密
- 敏感数据在存储时进行加密处理
- 用户配置信息进行加密存储
- API密钥等敏感信息加密保存

### 5.2 数据隔离
- 不同用户的数据进行隔离存储
- 提供数据访问权限控制
- 防止越权访问其他用户数据

### 5.3 数据备份
- 定期备份重要Prompt数据
- 提供数据导出功能
- 支持数据恢复操作