# PromptPilot数据结构

## 1. 前端数据结构

### 概述
为了统一前端类型定义，提高代码可维护性和健壮性，PromptPilot模块及其子组件中使用的主要数据结构已进行重构。现在，这些类型主要来源于 Wails 自动生成的 `../../wailsjs/go/models.ts` 文件。这消除了前端重复的接口定义，确保了前后端数据模型的一致性。

### 1.1 提示词结构 (Prompt)
该结构体现在直接从 Wails 自动生成的 `../../wailsjs/go/models.ts` 中导入。
其定义与后端 Go 语言的 `main.Prompt` 结构体保持一致。
```typescript
// 示例导入方式 (在 .vue 文件中):
import { types } from "../../wailsjs/go/models";
import Prompt = types.Prompt;
```

### 1.2 服务器配置结构 (OllamaServerConfig)
该结构体现在直接从 Wails 自动生成的 `../../wailsjs/go/models.ts` 中导入。
其定义与后端 Go 语言的 `main.OllamaServerConfig` 结构体保持一致。
```typescript
// 示例导入方式 (在 .vue 文件中):
import { types } from "../../wailsjs/go/models";
import OllamaServerConfig = types.OllamaServerConfig;
```

### 1.3 模型结构 (Model)
该结构体现在直接从 Wails 自动生成的 `../../wailsjs/go/models.ts` 中导入。
其定义与后端 Go 语言的 `main.Model` 结构体保持一致。
```typescript
// 示例导入方式 (在 .vue 文件中):
import { types } from "../../wailsjs/go/models";
import Model = types.Model;
```

## 2. 后端事件数据结构

**说明**: 后端通过 Wails 的事件系统与前端进行流式通信。以下是定义的三种事件及其数据负载（Payload）的 TypeScript 接口。

### 2.1 `prompt_pilot_stream`

- **触发时机**: 在流式生成过程中，每当后端获得一小段新的文本块（chunk）时触发。
- **数据结构**:
  ```typescript
  interface StreamData {
    model: string;  // 产生该数据块的模型名称
    chunk: string;  // 新生成的文本数据块
  }
  ```

### 2.2 `prompt_pilot_stream_error`

- **触发时机**: 当某个模型的生成过程发生错误时触发。
- **数据结构**:
  ```typescript
  interface StreamErrorData {
    model: string; // 发生错误的模型名称
    error: string; // 详细的错误信息
  }
  ```

### 2.3 `prompt_pilot_stream_done`

- **触发时机**: 当某个模型成功完成所有内容的生成时触发。
- **数据结构**:
  ```typescript
  interface StreamDoneData {
    model: string; // 已完成生成的模型名称
  }
  ```

## 3. 存储设计

- **存储方式**: 使用 `duolasdk` 的哈希存储（HSet/HGetAll）功能。
- **主键 (Key)**: `"prompts"`
- **字段 (Field)**:
  - **字段名**: 每个 Prompt 的 `ID` (UUID)。
  - **字段值**: 完整的 `Prompt` 对象经过 JSON 序列化后的字符串。
