# 哆啦桌面端 - 故障排除

本文档列出了一些常见问题及其解决方案。

### 1. 模型列表显示 "Invalid Date"

-   **问题描述**: 在“模型管理”页面，模型的“修改时间”列显示为 "Invalid Date"。
-   **原因**: 前后端字段名不匹配。前端期望的字段是 `modifiedAt`，但后端返回的是 `modified_at`。
-   **解决方案**: 已在代码中修复。确保前端数据结构和后端Go结构体的 `json` 标签完全匹配，统一使用 `modified_at`。

### 2. 刷新后，正在运行的模型的“运行中”状态丢失

-   **问题描述**: 在“模型管理”页面，一个正在运行的模型在手动刷新列表后，其状态变回“已停止”。
-   **原因**: 模型运行状态之前仅由前端临时维护，刷新时被后端返回的原始数据（不包含运行状态）覆盖。
-   **解决方案**: 已将Go后端作为模型运行状态的唯一权威来源。后端维护一个 `runningModels` 列表，每次前端请求模型列表时，后端都会附加准确的运行状态。

### 3. 点击“运行”或“测试”按钮时，应用闪退

-   **问题描述**: 在“模型管理”页面，点击“运行模型”时程序崩溃。
-   **原因**: 后端核心组件 `httpClient` 未被正确初始化，导致在使用时发生空指针引用 (`nil pointer dereference`)。
-   **解决方案**: 已在后端的构造函数中确保所有核心组件都已正确初始化。

### 4. OpenAI 适配器或 API 调试器请求失败，提示 "CORS" 或 "Load failed"

-   **问题描述**: 使用API调试器或外部应用调用OpenAI适配器接口时，浏览器控制台报告CORS（跨域资源共享）错误。
-   **原因**: 后端HTTP服务没有正确处理浏览器的 `OPTIONS` 预检请求，也未在响应中添加必要的 `Access-Control-Allow-*` 头。
-   **解决方案**: 已在Go后端的HTTP服务中添加了CORS中间件。该中间件会：
    1.  正确响应 `OPTIONS` 请求（返回200 OK）。
    2.  为所有响应添加 `Access-Control-Allow-Origin: *`、`Access-Control-Allow-Methods` 和 `Access-Control-Allow-Headers` 等响应头。

### 5. 模型下载过程中出错，但界面提示“下载完成”

-   **问题描述**: 下载一个不兼容或不存在的模型时，后端实际已出错，但前端界面依然显示下载成功。
-   **原因**: 后端在处理下载的流式响应时，未能正确捕获并处理流中嵌入的错误信息，导致无论成功与否都发送了“完成”事件。
-   **解决方案**: 已增强后端的错误检测逻辑。现在当下载流中出现错误时，会立即中断并向前端发送一个专门的错误事件，而不是完成事件。

### 6. 删除了所有服务配置后，应用重启又会自动创建一个“本地服务”

-   **问题描述**: 即使用户在“服务设置”中清空了所有服务器，下次启动应用时，“本地服务”配置又出现了。
-   **原因**: 后端有一个“自作聪明”的逻辑，在检测到没有配置时会自动创建一个默认的本地服务。
-   **解决方案**: 已移除该逻辑。现在应用会如实反映用户的配置状态。如果列表为空，则前端会提示用户前往设置页面添加服务。
